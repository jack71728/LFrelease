/*! @source http://purl.eligrey.com/github/classList.js/blob/master/classList.js*/

/*! peerjs.js build:0.3.7, development. Copyright(c) 2013 Michelle Bu <michelle@michellebu.com> */

define("F.core/css",{load:function(e,t,n,r){function i(e){var t=document.getElementsByTagName("head")[0],n=document.createElement("link");n.href=e,n.rel="stylesheet",n.type="text/css",t.appendChild(n)}i(requirejs.toUrl(e)),n(!0)},pluginBuilder:"./css-build"}),define("F.core/css-embed",function(){function e(e){var t=document.getElementsByTagName("head")[0],n=document.createElement("style"),r=document.createTextNode(e);n.type="text/css",n.styleSheet?n.styleSheet.cssText=r.nodeValue:n.appendChild(r),t.appendChild(n)}return e}),define("F.core/css!F.core/style.css",["F.core/css-embed"],function(e){return e(".F_sprite { position:absolute; overflow:hidden; width:10px; height:10px; } .F_sprite_group { position:absolute; } .F_sprite_inline { overflow:hidden; width:10px; height:10px; } .F_sprite_img { position:absolute; } /* .canvas { position:relative; width:800px; height:300px; border:1px solid #000; } .page { position: absolute; left: 0px; top: 0px; border: 1px solid #000; z-index: 10000; }*/"),!0}),define("F.core/support",[],function(){var e={};return function(){var t=navigator.appName,n=navigator.userAgent,r,i=n.match(/(opera|chrome|safari|firefox|msie)\/?\s*(\.?\d+(\.\d+)*)/i);i&&(r=n.match(/version\/([\.\d]+)/i))!=null&&(i[2]=r[1]),i=i?[i[1],i[2]]:[t,navigator.appVersion,"-?"],e.browser=i[0],e.browser_name=i[0],e.browser_version=i[1];var s=/iPad|iPod|iPhone|Android|webOS|IEMobile/i.exec(navigator.userAgent.toLowerCase());e.mobile=s?s[0]:undefined;var o=window.getComputedStyle(document.documentElement,""),u=(Array.prototype.slice.call(o).join("").match(/-(moz|webkit|ms)-/)||o.OLink===""&&["","o"])[1],a="WebKit|Moz|MS|O".match(new RegExp("("+u+")","i"))[1];e.prefix=a,e.prefix_dom=a,e.prefix_css="-"+u+"-",e.prefix_js=u[0].toUpperCase()+u.substr(1)}(),function(){var t=document.createElement("p"),n,r,i={WebkitTransform:"-webkit-transform",OTransform:"-o-transform",MSTransform:"-ms-transform",MozTransform:"-moz-transform",transform:"transform"};document.getElementsByTagName("body")[0].appendChild(t);for(n in i)if(t.style[n]!==undefined){var s;s="matrix(1, 0, 0, 1, 0, 0)",t.style[n]=s,s===window.getComputedStyle(t).getPropertyValue(i[n])&&(e.css2dtransform=n),s="matrix3d(1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 1, 1, 1, 1)",t.style[n]=s,window.getComputedStyle(t).getPropertyValue(i[n]).indexOf("matrix3d")===0&&(e.css3dtransform=n)}t.parentNode.removeChild(t)}(),!window.localStorage||!window.sessionStorage?function(){var t=function(e){function t(e,t,n){var r,i;n?(r=new Date,r.setTime(r.getTime()+n*24*60*60*1e3),i="; expires="+r.toGMTString()):i="",document.cookie=e+"="+t+i+"; path=/"}function n(e){var t=e+"=",n=document.cookie.split(";"),r,i;for(r=0;r<n.length;r++){i=n[r];while(i.charAt(0)==" ")i=i.substring(1,i.length);if(i.indexOf(t)==0)return i.substring(t.length,i.length)}return null}function r(n){n=JSON.stringify(n),e=="session"?window.name=n:t("localStorage",n,365)}function i(){e=="session"?window.name="":t("localStorage","",365)}function s(){var t=e=="session"?window.name:n("localStorage");return t?JSON.parse(t):{}}function u(){var e=0;for(var t in o)o.hasOwnProperty(t)&&(e+=1);return e}var o=s();return{clear:function(){o={},i(),this.length=u()},getItem:function(e){return e=encodeURIComponent(e),o[e]===undefined?null:o[e]},key:function(e){var t=0;for(var n in o){if(t==e)return decodeURIComponent(n);t++}return null},removeItem:function(e){e=encodeURIComponent(e),delete o[e],r(o),this.length=u()},setItem:function(e,t){e=encodeURIComponent(e),o[e]=String(t),r(o),this.length=u()},length:0}};window.localStorage||(e.localStorage=new t("local")),window.sessionStorage||(e.sessionStorage=new t("session"))}():(e.localStorage=window.localStorage,e.sessionStorage=window.sessionStorage),"document"in self&&!("classList"in document.createElement("_")&&"classList"in document.createElementNS("http://www.w3.org/2000/svg","svg"))&&function(e){if(!("Element"in e))return;var t="classList",n="prototype",r=e.Element[n],i=Object,s=String[n].trim||function(){return this.replace(/^\s+|\s+$/g,"")},o=Array[n].indexOf||function(e){var t=0,n=this.length;for(;t<n;t++)if(t in this&&this[t]===e)return t;return-1},u=function(e,t){this.name=e,this.code=DOMException[e],this.message=t},a=function(e,t){if(t==="")throw new u("SYNTAX_ERR","An invalid or illegal string was specified");if(/\s/.test(t))throw new u("INVALID_CHARACTER_ERR","String contains an invalid character");return o.call(e,t)},f=function(e){var t=s.call(e.getAttribute("class")),n=t?t.split(/\s+/):[],r=0,i=n.length;for(;r<i;r++)this.push(n[r]);this._updateClassName=function(){e.setAttribute("class",this.toString())}},l=f[n]=[],c=function(){return new f(this)};u[n]=Error[n],l.item=function(e){return this[e]||null},l.contains=function(e){return e+="",a(this,e)!==-1},l.add=function(){var e=arguments,t=0,n=e.length,r,i=!1;do r=e[t]+"",a(this,r)===-1&&(this.push(r),i=!0);while(++t<n);i&&this._updateClassName()},l.remove=function(){var e=arguments,t=0,n=e.length,r,i=!1;do{r=e[t]+"";var s=a(this,r);s!==-1&&(this.splice(s,1),i=!0)}while(++t<n);i&&this._updateClassName()},l.toggle=function(e,t){e+="";var n=this.contains(e),r=n?t!==!0&&"remove":t!==!1&&"add";return r&&this[r](e),!n},l.toString=function(){return this.join(" ")};if(i.defineProperty){var h={get:c,enumerable:!0,configurable:!0};try{i.defineProperty(r,t,h)}catch(p){p.number===-2146823252&&(h.enumerable=!1,i.defineProperty(r,t,h))}}else i[n].__defineGetter__&&r.__defineGetter__(t,c)}(self),e}),define("F.core/util",[],function(){var e={css:function(e){var t=document.getElementsByTagName("head")[0],n=document.createElement("link");n.href=e,n.rel="stylesheet",n.type="text/css",t.appendChild(n)},make_array:function(e){return e?e instanceof Array?e:[e]:[]},search_array:function(e,t,n,r){var i=new Array;for(var s in e)if(t(e[s],s)){n&&(e[s]=n(e[s]));if(!r)return s;i.push(s)}return r?i:-1},arr_search:function(t,n,r,i){return e.search_array(t,n,r,i)},push_unique:function(t,n){var r=e.arr_search(t,function(e){return e==n});if(r==-1)return t.push(n),!0},extend_object:function(e,t){for(var n in t)typeof t[n]=="object"?e[n]=arguments.callee(e[n]?e[n]:t[n]instanceof Array?[]:{},t[n]):e[n]=t[n];return e},to_text:function(e,t,n,r,i,s){if(s===0)return"";s||(s=30),n||(n="\n"),r||(r="");var o=r+t+":"+n;o+=r+"{";var u=0;for(var a in e){var f=i&&i(a,e[a]);f!=1&&(typeof f=="string"?o+=(u?",":"")+n+r+"	"+"'"+a+"'"+": "+f:e[a].constructor==Object?o+=(u?",":"")+n+arguments.callee(e[a],a,n,r+"	",i,s-1):(o+=(u?",":"")+n+r+"	"+"'"+a+"'"+": ",typeof e[a]=="string"&&(o+="'"),o+=e[a],typeof e[a]=="string"&&(o+="'"))),u=1}return o+=n+r+"}",o},extract_array:function(t,n){var r={};n=e.make_array(n);for(var i in n)r[n[i]]=[];for(var s=0;s<t.length;s++)for(var o=0;o<n.length;o++){var u=n[o];r[u].push(t[s][u])}return r},group_elements:function(e,t){var n={};for(var r=0;r<e.length;r++)if(e[r][t]){var i=e[r][t];n[i]||(n[i]=[]),n[i].push(e[r])}return n},for_each:function(e,t){if(e instanceof Array)for(var n=0;n<e.length;n++)t(e[n],n);else if(e)for(var r in e)t(e[r])},call_each:function(e,t){var n=Array.prototype.slice.call(arguments,2);if(e instanceof Array)for(var r=0;r<e.length;r++)typeof e[r][t]=="function"&&e[r][t].apply(null,n);else if(e)for(var r in e)typeof e[r][t]=="function"&&e[r][t].apply(null,n)}};return e}),define("F.core/resourcemap",["F.core/util"],function(e){function t(t){this.map=e.make_array(t);for(var r=0;r<this.map.length;r++)this.map[r]=new n(this.map[r])}function n(e){this.map=e,this.update_condition()}return t.prototype.update_condition=function(){e.call_each(this.map,"update_condition")},t.prototype.get=function(e){var t;for(var n=0;n<this.map.length;n++){t=this.map[n].get(e);if(t)break}return t||e},n.prototype.update_condition=function(){this.map.condition?this.enable=this.map.condition()||!1:this.enable=!0,typeof this.map.resource!="object"&&typeof this.map.get!="function"&&(this.enable=!1)},n.prototype.get=function(e){if(this.enable){if(this.map.resource&&this.map.resource[e])return this.map.resource[e];var t=this.map.get&&this.map.get(e);if(t)return t}return null},t}),define("F.core/sprite",["F.core/css!F.core/style.css","F.core/support","F.core/resourcemap","module"],function(e,t,n,r){function o(e){this.ID=i,i++;var n="F_sprite";e.type==="group"?n="F_sprite_group":e.div&&(n="F_sprite_inline"),e.div?(this.el=e.div,this.el.classList.add(n),window.getComputedStyle(this.el).getPropertyValue("position")==="static"&&(this.el.style.position="relative")):(this.el=document.createElement("div"),this.el.className=n,e.canvas&&e.canvas.appendChild(this.el)),this.img={},this.cur_img=null,e.wh==="fit"?this.fit_to_img=!0:typeof e.wh=="object"&&this.set_wh(e.wh);if(e.img)if(typeof e.img=="object")for(var r in e.img)this.add_img(e.img[r],r);else this.add_img(e.img,"0");if(e.div&&e.type!=="group"){var o=e.div.getElementsByTagName("img");for(var u=0;u<o.length;u++){var a=o[u].getAttribute("name");a&&this.adopt_img(o[u])}}if(t.css3dtransform&&!s.disable_css3dtransform||t.css2dtransform&&!s.disable_css2dtransform)e.div||(this.el.style.left="0px",this.el.style.top="0px"),this.x=0,this.y=0}var i=0,s=r.config()||{};return o.masterconfig=o.prototype.masterconfig=function(e){if(!e)return s;s=e,o.masterconfig_update()},o.masterconfig_set=o.prototype.masterconfig_set=function(e,t){e&&t&&(s[e]=t,o.masterconfig_update())},o.masterconfig_update=function(){s.resourcemap&&(s.resourcemap instanceof n||(s.resourcemap=new n(s.resourcemap)))},o.resolve_resource=function(e){return s.resourcemap?s.resourcemap.get(e):s.baseUrl?s.baseUrl+e:e},o.preload_image=function(e){var t=new Image;t.src=o.resolve_resource(e)},o.prototype.set_wh=function(e){this.el.style.width=e.x+"px",this.el.style.height=e.y+"px"},o.prototype.set_w_h=function(e,t){this.el.style.width=e+"px",this.el.style.height=t+"px"},o.prototype.set_w=function(e){this.el.style.width=e+"px"},o.prototype.set_h=function(e){this.el.style.height=e+"px"},t.css3dtransform&&!s.disable_css3dtransform?(o.prototype.set_xy=function(e){this.x=e.x,this.y=e.y,this.el.style[t.css3dtransform]="translate3d("+e.x+"px,"+e.y+"px, 0px) "+(this.mirrored?"scaleX(-1) ":"")},o.prototype.set_x_y=function(e,n){this.x=e,this.y=n,this.el.style[t.css3dtransform]="translate3d("+e+"px,"+n+"px, 0px) "+(this.mirrored?"scaleX(-1) ":"")},o.prototype.mirror=function(e){this.mirrored=e,this.set_x_y(this.x,this.y)}):t.css2dtransform&&!s.disable_css2dtransform?(o.prototype.set_xy=function(e){this.x=e.x,this.y=e.y,this.el.style[t.css2dtransform]="translate("+e.x+"px,"+e.y+"px) "+(this.mirrored?"scaleX(-1) ":"")},o.prototype.set_x_y=function(e,n){this.x=e,this.y=n,this.el.style[t.css2dtransform]="translate("+e+"px,"+n+"px) "+(this.mirrored?"scaleX(-1) ":"")},o.prototype.mirror=function(e){this.mirrored=e,this.set_x_y(this.x,this.y)}):(o.prototype.set_xy=function(e){this.el.style.left=e.x+"px",this.el.style.top=e.y+"px"},o.prototype.set_x_y=function(e,t){this.el.style.left=e+"px",this.el.style.top=t+"px"},o.prototype.mirror=function(e){}),o.prototype.set_z=function(e){this.el.style.zIndex=Math.round(e)},o.prototype.add_img=function(e,t){function i(){this.naturalWidth||(this.naturalWidth=this.width),this.naturalHeight||(this.naturalHeight=this.height),n.fit_to_img&&n.set_w_h(this.naturalWidth,this.naturalHeight),r.removeEventListener("load",i,!0)}var n=this,r=document.createElement("img");return r.setAttribute("class","F_sprite_img"),r.addEventListener("load",i,!0),r.src=o.resolve_resource(e),this.el.appendChild(r),this.img[t]=r,this.switch_img(t),r},o.prototype.adopt_img=function(e){function n(){this.naturalWidth||(this.naturalWidth=this.width),this.naturalHeight||(this.naturalHeight=this.height),e.removeEventListener("load",n,!0)}var t=e.getAttribute("name");e.classList.add("F_sprite_img"),e.naturalWidth||(e.naturalWidth=e.width),e.naturalHeight||(e.naturalHeight=e.height),!e.naturalWidth&&!e.naturalHeight&&e.addEventListener("load",n,!0),this.img[t]=e,this.switch_img(t)},o.prototype.switch_img=function(e){var t,n;for(var r in this.img)if(this.img[r].style.display==""){t=this.img[r].style.left,n=this.img[r].style.top;break}for(var r in this.img)r==e?(this.img[r].style.left=t,this.img[r].style.top=n,this.img[r].style.display=""):this.img[r].style.display="none";this.cur_img=e},t.css3dtransform&&!s.disable_css3dtransform?(o.prototype.set_img_xy=function(e){this.x=e.x,this.y=e.y,this.img[this.cur_img].style[t.css3dtransform]="translate3d("+e.x+"px,"+e.y+"px, 0px) "},o.prototype.set_img_x_y=function(e,n){this.x=e,this.y=n,this.img[this.cur_img].style[t.css3dtransform]="translate3d("+e+"px,"+n+"px, 0px) "}):t.css2dtransform&&!s.disable_css2dtransform?(o.prototype.set_img_xy=function(e){this.x=e.x,this.y=e.y,this.img[this.cur_img].style[t.css2dtransform]="translate("+e.x+"px,"+e.y+"px) "},o.prototype.set_img_x_y=function(e,n){this.x=e,this.y=n,this.img[this.cur_img].style[t.css2dtransform]="translate("+e+"px,"+n+"px) "}):(o.prototype.set_img_xy=function(e){this.img[this.cur_img].style.left=e.x+"px",this.img[this.cur_img].style.top=e.y+"px"},o.prototype.set_img_x_y=function(e,t){this.img[this.cur_img].style.left=e+"px",this.img[this.cur_img].style.top=t+"px"}),o.prototype.draw_to_canvas=function(e){var t=this.img[this.cur_img];e.drawImage(t,-parseInt(t.style.left),-parseInt(t.style.top),parseInt(this.el.style.width),parseInt(this.el.style.height),parseInt(this.el.style.left),parseInt(this.el.style.top),parseInt(this.el.style.width),parseInt(this.el.style.height))},o.prototype.remove=function(){!this.removed&&this.el.parentNode&&(this.removed=this.el.parentNode,this.el.parentNode.removeChild(this.el))},o.prototype.attach=function(){this.removed&&(this.removed.appendChild(this.el),this.removed=null)},o.prototype.hide=function(){this.el.style.display="none"},o.prototype.show=function(){this.el.style.display=""},o}),define("F.core/math",[],function(){return math={inbetween:function(e,t,n){var r,i;return t<=n?(r=t,i=n):(r=n,i=t),e>=r&&e<=i},round_d2:function(e){return Math.round(e*100)/100},negligible:function(e){return-1e-8<e&&e<1e-8},bezier2:function(e,t,n,r){var i=new Array;for(var s=0;s<r;s++)i.push(math.bezier2_step(e,t,n,s,r));return i.push(n),i},bezier2_step:function(e,t,n,r,i){function o(e,t,n,r){return((r-n)*e+n*t)/r}var s={x:0,y:0};return s.x=o(o(e.x,t.x,r,i),o(t.x,n.x,r,i),r,i),s.y=o(o(e.y,t.y,r,i),o(t.y,n.y,r,i),r,i),s},add:function(e,t){return{x:e.x+t.x,y:e.y+t.y}},sub:function(e,t){return{x:e.x-t.x,y:e.y-t.y}},sca:function(e,t){return{x:e.x*t,y:e.y*t}},length:function(e){return Math.sqrt(e.x*e.x+e.y*e.y)},distance:function(e,t){return Math.sqrt((t.x-e.x)*(t.x-e.x)+(t.y-e.y)*(t.y-e.y))},negative:function(e){return{x:-e.x,y:-e.y}},normalize:function(e){return math.sca(e,1/math.length(e))},perpen:function(e){return{x:-e.y,y:e.x}},signed_area:function(e,t,n){var r=(t.x-e.x)*(n.y-e.y)-(n.x-e.x)*(t.y-e.y);return r},intersect:function(e,t,n,r){var i,s,o,u,a;return o=(r.y-n.y)*(t.x-e.x)-(r.x-n.x)*(t.y-e.y),u=(r.x-n.x)*(e.y-n.y)-(r.y-n.y)*(e.x-n.x),a=(t.x-e.x)*(e.y-n.y)-(t.y-e.y)*(e.x-n.x),negligible(u)&&negligible(a)&&negligible(o)?{x:(e.x+t.x)*.5,y:(e.y+t.y)*.5}:negligible(o)?{x:0,y:0}:(i=u/o,s=a/o,{x:e.x+i*(t.x-e.x),y:e.y+i*(t.y-e.y)})}},math}),define("F.core/css!LF/tools/tools.css",["F.core/css-embed"],function(e){return e("table {  border:1px solid #000; } td {  border:1px solid #AAA;  width:auto; } #data {  width: 7000px; } .errorlabel {  background-color: #f00;  color: #fff;  padding: 0 5px;  border-radius: 3px; }  .Fbar {  padding-left:250px;  height:60px;  background: #7c547c;  background-image:url('http://docs.google.com/document/d/1DcPRilw9xEn8tET09rWet3o7x12rD-SkM5SoVJO1nnQ/pubimage?id=1DcPRilw9xEn8tET09rWet3o7x12rD-SkM5SoVJO1nnQ&image_id=19OMD_e2s9wHU52R1ofJIjUrpOP_KI3jKUh9n'),  linear-gradient(to right,  #7c547c 0%,#444466 50%);  background-repeat:no-repeat;  background-position:0px 0px;  background-size: contain;  color:#FFF;  font-size:30px;  line-height:60px;  flex: initial; } .Fbar a {  background-color:#FFF;  color:#7c547c;  padding:5px 15px;  margin:0 10px;  border-radius:10px; } #overall {  font-size: 40px;  border: 1px solid #000;  padding: 5px;  margin-bottom: 5px; } .canvas { position:relative; width:800px; height:300px; border:1px solid #000; }"),!0}),define("F.core/animator",[],function(){function e(e){this.config=e,this.target=e.tar,this.I=0,this.horimirror=!1,e.borderright||(e.borderright=0),e.borderbottom||(e.borderbottom=0),e.borderleft||(e.borderleft=0),e.bordertop||(e.bordertop=0)}return e.prototype.next_frame=function(){var e=this.config;this.I++;if(!e.ani)this.I==e.gx*e.gy&&(this.I=0),this.show_frame(this.I);else{var t=e.ani[this.I];if(this.I>=e.ani.length||this.I<0)this.I=0,t=e.ani[0];this.show_frame(t)}return this.I},e.prototype.seek=function(e){var t=this.config;if(t.ani&&e>=0&&e<t.ani.length){this.I=e;var n=t.ani[this.I];this.show_frame(n)}},e.prototype.rewind=function(){this.I=-1,this.next_frame()},e.prototype.set_frame=function(e){this.I=e,this.show_frame(e)},e.prototype.show_frame=function(e){var t=this.config,n,r;n=-(e%t.gx*t.w+t.x+t.borderleft),r=-(Math.floor(e/t.gx)*t.h+t.y+t.bordertop),this.horimirror&&(n=-this.target.img[this.target.cur_img].naturalWidth-n+t.w-t.borderleft-t.borderright),this.target.set_w_h(t.w-t.borderleft-t.borderright,t.h-t.bordertop-t.borderbottom),this.target.set_img_x_y(n,r)},e.prototype.get_at=function(e){e||(e=this.I);var t=this.config;return t.graph[e%t.gx][Math.floor(e/t.gx)]},e.set=function(t,n){if(!t)return null;var r=new Object;for(var i in t){if(n&&i==n)continue;if(n&&t[n])for(var s in t[n])t[i][s]=t[n][s];r[i]=new e(t[i])}return r},e}),define("LF/sprite",["F.core/sprite","F.core/animator"],function(e,t){function n(n,r){var i=this.num_of_images=n.file.length,s=this.w=n.file[0].w+1,o=this.h=n.file[0].h+1,u=this.ani=[];this.dir="right",this.cur_img=0;var a={canvas:r,wh:{x:s,y:o},img:{}},f=this.sp=new e(a);for(var l=0;l<n.file.length;l++){var c="";for(var h in n.file[l])typeof n.file[l][h]=="string"&&h.indexOf("file")===0&&(c=n.file[l][h]);c===""&&console.log("cannot find img path in data:\n"+JSON.stringify(n.file[l])),f.add_img(c,l);var p={x:0,y:0,w:n.file[l].w+1,h:n.file[l].h+1,gx:n.file[l].row,gy:n.file[l].col,tar:f,borderleft:0,bordertop:0,borderright:1,borderbottom:1};u.length++,u[l]=new t(p)}}return n.prototype.destroy=function(){this.sp.remove(),this.sp=null,this.ani.length=0},n.prototype.show_pic=function(e){var t=0;for(var n=0;n<this.ani.length;n++){var r=e-this.ani[n].config.gx*this.ani[n].config.gy;if(!(r>=0))break;e=r,t++}t>=this.ani.length&&(t=this.ani.length-1,e=999),this.cur_img=t,this.sp.switch_img(this.cur_img),this.ani[this.cur_img].set_frame(e),this.w=this.ani[this.cur_img].config.w,this.h=this.ani[this.cur_img].config.h},n.prototype.switch_lr=function(e){e!==this.dir&&(this.dir=e,this.sp.mirror(e==="left"))},n.prototype.set_x_y=function(e,t){this.sp.set_x_y(e,t)},n.prototype.set_z=function(e){this.sp.set_z(e)},n.prototype.show=function(){this.sp.show()},n.prototype.hide=function(){this.sp.hide()},n}),define("LF/util",[],function(){typeof console=="undefined"&&(console={},console.log=function(){});var e={};return e.select_from=function(e,t,n){var r=[];for(var i in e){var s=e[i],o=!0;if(typeof t=="function")t(s)||(o=!1);else for(var u in t)s[u]!==t[u]&&(o=!1);o&&r.push(s)}if(r.length===0)return;return r.length===1?r[0]:r},e.lookup=function(e,t){for(var n in e)if(t<=n)return e[n]},e.lookup_abs=function(e,t){t<0&&(t=-t);for(var n in e)if(t<=n)return e[n]},e.shallow_copy=function(e){var t={};for(var n in e)t[n]=e[n];return t},e.div=function(t){if(!e.container){e.container=document.getElementsByClassName("LFcontainer")[0];if(!e.container)return null}return t?e.container.getElementsByClassName(t)[0]:e.container},e.filename=function(e){return e.lastIndexOf("/")!==-1&&(e=e.slice(e.lastIndexOf("/")+1)),e.lastIndexOf(".js")!==-1&&(e=e.slice(0,e.lastIndexOf(".js"))),e},e.setup_resourcemap=function(e,t){var n=!1;if(e.resourcemap&&typeof e.resourcemap.condition=="string"){var r=e.resourcemap.condition.split(" ");r[0]==="location"&&r[1]==="contain"&&r[2]&&r[3]==="at"&&r[4]?(r[4]=parseInt(r[4]),e.resourcemap.condition=function(){return window.location.href.indexOf(r[2])===r[4]}):r[0]==="location"&&r[1]==="contain"&&r[2]&&(e.resourcemap.condition=function(){return window.location.href.indexOf(r[2])!==-1});if(typeof e.resourcemap.condition=="function"){var i=[e.resourcemap,{get:function(t){return e.location+t}}];t.masterconfig_set("resourcemap",i),n=!0}}n||t.masterconfig_set("baseUrl",e.location)},e.location_parameters=function(){var e=window.location.href.split("/").pop(),t={};if(e.indexOf("?")!==-1){var e=e.split("?").pop().split("&");for(var n=0;n<e.length;n++)pp=e[n].split("="),pp.length===1&&(t[pp[0]]=1),pp.length===2&&(t[pp[0]]=pp[1])}return t},e}),define("LF/global",["LF/util"],function(e){var t={};t.application={};var n=t.application;n.window={},n.window.width=794,n.window.height=550,n.viewer={},n.viewer.height=400,n.camera={},n.camera.speed_factor=1/18,t.combo_list=[{name:"D<A",seq:["def","left","att"],clear_on_combo:!1},{name:"D>A",seq:["def","right","att"],clear_on_combo:!1},{name:"DvA",seq:["def","down","att"]},{name:"D^A",seq:["def","up","att"]},{name:"DvJ",seq:["def","down","jump"]},{name:"D^J",seq:["def","up","jump"]},{name:"D<J",seq:["def","left","jump"]},{name:"D>J",seq:["def","right","jump"]},{name:"D<AJ",seq:["def","left","att","jump"]},{name:"D>AJ",seq:["def","right","att","jump"]},{name:"DJA",seq:["def","jump","att"]}],t.combo_tag={def:"hit_d",jump:"hit_j",att:"hit_a","D>A":"hit_Fa","D<A":"hit_Fa",DvA:"hit_Da","D^A":"hit_Ua",DvJ:"hit_Dj","D^J":"hit_Uj","D>J":"hit_Fj","D<J":"hit_Fj","D<AJ":"hit_Fj","D>AJ":"hit_Fj",DJA:"hit_ja"},t.combo_priority={up:0,down:0,left:0,right:0,def:0,jump:0,att:0,run:0,"D>A":1,"D<A":1,DvA:1,"D^A":1,DvJ:1,"D^J":1,"D>J":1,"D<J":1,"D<AJ":1,"D>AJ":1,DJA:1},t.lazyload=function(t){this.character_list||(this.character_list={});if(t.type==="character"){var n=e.filename(t.file);return this.character_list[n]=!0,!0}if(t.type){var n=e.filename(t.file);n.lastIndexOf("_")!==-1&&(n=n.slice(0,n.lastIndexOf("_")));if(this.character_list[n])return!0}return!1},t.gameplay={};var r=t.gameplay;return r.default={},r.default.health={},r.default.health.hp_full=500,r.default.health.mp_full=500,r.default.health.mp_start=200,r.default.itr={},r.default.itr.zwidth=12,r.default.itr.hit_stop=3,r.default.itr.throw_injury=10,r.default.cpoint={},r.default.cpoint.hurtable=0,r.default.cpoint.cover=0,r.default.cpoint.vaction=135,r.default.wpoint={},r.default.wpoint.cover=0,r.default.effect={},r.default.effect.num=0,r.default.fall={},r.default.fall.value=20,r.default.fall.dvy=-6.9,r.default.weapon={},r.default.weapon.vrest=9,r.default.character={},r.default.character.arest=7,r.default.machanics={},r.default.machanics.mass=1,r.recover={},r.recover.fall=-0.45,r.recover.bdefend=-0.5,r.effect={},r.effect.num_to_id=300,r.effect.duration=3,r.character={},r.character.bounceup={},r.character.bounceup.limit={},r.character.bounceup.limit.xy=13.4,r.character.bounceup.limit.y=11,r.character.bounceup.y=4.25,r.character.bounceup.absorb={9:1,14:4,20:10,40:20},r.defend={},r.defend.injury={},r.defend.injury.factor=.1,r.defend.break_limit=40,r.defend.absorb={5:0,15:5},r.fall={},r.fall.KO=60,r.fall.wait180={7:1,9:2,11:3,13:4,15:5,17:6},r.friction={},r.friction.fell={2:0,3:1,5:2,6:4,9:5,13:7,25:9},r.min_speed=1,r.gravity=1.7,r.weapon={},r.weapon.bounceup={},r.weapon.bounceup.limit=8,r.weapon.bounceup.speed={},r.weapon.bounceup.speed.y=-3.7,r.weapon.bounceup.speed.x=3,r.weapon.bounceup.speed.z=1.5,r.weapon.soft_bounceup={},r.weapon.soft_bounceup.speed={},r.weapon.soft_bounceup.speed.y=-2,r.weapon.hit={},r.weapon.hit.vx=-3,r.weapon.hit.vy=0,r.weapon.reverse={},r.weapon.reverse.factor={},r.weapon.reverse.factor.vx=-0.4,r.weapon.reverse.factor.vy=-2,r.weapon.reverse.factor.vz=-0.4,r.unspecified=-842150451,t}),define("LF/loader",["LF/global","F.core/util"],function(e,t){return{load:function(n,r,i,s){function l(e){o=c(e),u.location=c(s.baseUrl)+o,r([h("manifest")],function(e){a=e;var t={data:"string",resourcemap:"string!optional"};g(t,a)||console.log("loader: error: manifest.js of "+o+" is not correct."),r([h(a.data)],p),d("resourcemap")})}function c(e){return e?(e=e.replace(/\\/g,"/"),e.charAt(e.length-1)!=="/"&&(e+="/"),e.charAt(0)==="/"&&(e=e.slice(1)),e):""}function h(e){if(!e)return"";e.lastIndexOf(".js")===e.length-3&&(e=e.slice(0,e.length-3));var t=o.indexOf("http")===0?".js":"";return o+e+t}function p(n){function i(t){if(typeof e.lazyload!="function")return!0;if(!e.lazyload(t))return!0}var s=[];for(var o in n)if(n[o]instanceof Array)for(var a=0;a<n[o].length;a++)n[o][a].file&&i(n[o][a])&&s.push(h(n[o][a].file));else typeof n[o]=="object"&&n[o].file&&i(n[o])&&s.push(h(n[o].file));r(s,function(){var e=t.extend_object({},n),r=0;for(var s in n)if(n[s]instanceof Array)for(var o=0;o<n[s].length;o++)n[s][o].file&&(i(n[s][o])?(e[s][o].data=arguments[r],r++):e[s][o].data="lazy");else typeof n[s]=="object"&&n[s].file&&(i(n[s])?(e[s].data=arguments[r],r++):e[s].data="lazy");u.data=e,m(),v()})}function d(e){r([h(a[e])],function(t){u[e]=t,v()})}function v(){var e={data:"object",resourcemap:"object!optional",location:"string"};g(e,u)&&i(u)}function m(){typeof e.lazyload=="function"&&(u.data.object.load=function(e,t){var n=u.data.object,r=[],i=[];for(var s=0;s<e.length;s++){var o;for(var a=0;a<n.length;a++)if(n[a].id===e[s]){o=n[a];break}o&&o.file&&o.data==="lazy"&&(r.push(o),i.push(h(o.file)))}requirejs(i,function(){for(var e=0;e<arguments.length;e++)r[e].data=arguments[e];t()})})}function g(e,t){var n=!1;if(t){n=!0;for(var r in e){var i=e[r].split("!"),s=i[0],o=i[1]||"";if(typeof t[r]!==s)if(typeof t[r]!="undefined"||!o||o!=="optional"){n=!1;break}}}return n}var o="",u={},a={};if(s.isBuild){i();return}if(document.getElementById("flf-config")){var f=document.getElementById("flf-config").innerHTML;f=JSON.parse(f);if(!f.package){i();return}l(f.package)}},normalize:function(e,t){return e}}}),define("F.core/controller",[],function(){function e(e){return n.key(e,1)}function t(e){return n.key(e,0)}function r(e){this.state={},this.config=e,this.keycode={},this.child=new Array,this.sync=!1,this.buf=new Array,n.child.push(this),this.clear_states();for(var t in this.config)this.keycode[t]=r.keyname_to_keycode(this.config[t])}"onhelp"in window&&(window.onhelp=function(){return!1});var n=function(){document.addEventListener?(document.addEventListener("keydown",e,!0),document.addEventListener("keyup",t,!0)):document.attachEvent&&(document.attachEvent("keydown",e),document.attachEvent("keyup",t));var n=new Object;return n.child=[],n.key=function(e,t){e||(e=window.event);for(var n in this.child)if(this.child[n].key(e.keyCode,t))break;return e.cancelBubble=!0,e.returnValue&&(e.returnValue=!1),e.stopPropagation&&(e.stopPropagation(),e.preventDefault()),!1},n}();return r.prototype.type="keyboard",r.prototype.key=function(e,t){var n=0;for(var r in this.config)if(this.keycode[r]==e){if(this.sync===!1){if(this.child)for(var i in this.child)this.child[i].key(r,t);this.state[r]=t}else this.buf.push([r,t]);n=1;break}return n},r.prototype.clear_states=function(){for(var e in this.config)this.state[e]=0},r.prototype.fetch=function(){for(var e=0;e<this.buf.length;e++){var t=this.buf[e][0],n=this.buf[e][1];if(this.child)for(var r=0;r<this.child.length;r++)this.child[r].key(t,n);this.state[t]=n}this.buf.length=0},r.prototype.flush=function(){this.buf=[]},r.keyname_to_keycode=r.prototype.keyname_to_keycode=function(e){if(typeof e=="number")return e;var t;if(e.length==1){var n=e.charCodeAt(0);if(n>="a".charCodeAt(0)&&n<="z".charCodeAt(0)||n>="A".charCodeAt(0)&&n<="Z".charCodeAt(0))e=e.toUpperCase(),t=e.charCodeAt(0);else if(n>="0".charCodeAt(0)&&n<="9".charCodeAt(0))t=e.charCodeAt(0);else switch(e){case"`":t=192;break;case"-":t=189;break;case"=":t=187;break;case"[":t=219;break;case"]":t=221;break;case"\\":t=220;break;case";":t=186;break;case"'":t=222;break;case",":t=188;break;case".":t=190;break;case"/":t=191;break;case" ":t=32}}else switch(e){case"ctrl":t=17;break;case"up":t=38;break;case"down":t=40;break;case"left":t=37;break;case"right":t=39;break;case"space":t=32;break;case"esc":t=27}return e.length==2&&e.charAt(0)==="F"&&(t=111+parseInt(e.slice(1))),t},r.keycode_to_keyname=r.prototype.keycode_to_keyname=function(e){if(e>="A".charCodeAt(0)&&e<="Z".charCodeAt(0)||e>="0".charCodeAt(0)&&e<="9".charCodeAt(0))return String.fromCharCode(e).toLowerCase();if(e>=112&&e<=123)return"F"+(e-111);var t=e;switch(e){case 38:t="up";break;case 40:t="down";break;case 37:t="left";break;case 39:t="right";break;case 32:t="space";break;case 27:t="esc"}return t},r}),function(e){function t(){function s(n,r){if(!e)return e=n,t=r,t>=30&&(t-=1),setInterval(u,t*.5);console.log("network: error: only one timer can be active at a time. please `clearInterval` before setting a new one.")}function o(t){clearInterval(t),e=null}function u(){if(e&&i.time!==undefined&&i.time!==null){var s=(new Date).getTime(),o=s-r;if(o>t-5){var u=e(i.time,i.data,n);r=s,i.time=null,i.data=null,u&&n(u)}}}function a(e,t,r,s,o){function p(e,t){i.time=e,i.data=t,u()}function d(){function i(){if(n)return;h=c.connect(s);var o;h.on("close",function(){console.log("connection closed")}),h.on("error",function(e){console.log("error:",e)}),h.on("open",function(){n=!0,h.send(JSON.stringify({m:"hi",id:r}))}),h.on("data",function(e){e=JSON.parse(e),e.m==="hi"?e.id===s&&!l[e.id]?(l[e.id]=!0,o=e.id,p(f,e.d)):(console.log("unknown peer"),h.close()):o&&(e.t!==f?console.log("out of sync",e.t,f):(t&&f++,p(f,e.d)))}),e++,e<10?setTimeout(i,5e3):console.log("failed to connect to peer.")}var e=0,n=!1;setTimeout(i,2e3)}function v(){c.on("connection",function(e){h=e;var t;h.on("close",function(){console.log("connection closed")}),h.on("error",function(e){console.log("error:",e)}),h.on("data",function(e){e=JSON.parse(e),e.m==="hi"?e.id===s&&!l[e.id]?(h.send(JSON.stringify({m:"hi",id:r})),l[e.id]=!0,t=e.id):(console.log("unknown peer"),h.close()):t&&(e.t!==f?console.log("out of sync"):p(f,e.d))})})}if(!r||!s)return console.log("network: no id."),!1;var a=!1,f=0,l={},c=new Peer(r,{host:e,debug:3,key:o||"flf"}),h;n=function(e){h.send(JSON.stringify({t:f,d:e})),t||f++},c.on("open",function(e){a||(a=!0,t&&d(),t||v())})}var e,t,n,r=(new Date).getTime(),i={};return{setup_peer:a,setInterval:s,clearInterval:o}}typeof define!="undefined"?define("F.core/network",[],t):e.Fcore_network=t()}(window),function(e){function n(){this._pieces=[],this._parts=[]}function r(e){this.index=0,this.dataBuffer=e,this.dataView=new Uint8Array(this.dataBuffer),this.length=this.dataBuffer.byteLength}function i(){this.bufferBuilder=new n}function s(e){var t=e.charCodeAt(0);return t<=2047?"00":t<=65535?"000":t<=2097151?"0000":t<=67108863?"00000":"000000"}function o(e){return e.length>600?(new Blob([e])).size:e.replace(/[^\u0000-\u007F]/g,s).length}function u(){this._events={}}function f(e,t){if(!(this instanceof f))return new f(e);this._dc=e,h.debug=t,this._outgoing={},this._incoming={},this._received={},this._window=1e3,this._mtu=500,this._interval=0,this._count=0,this._queue=[],this._setupDC()}function p(e,t){if(!(this instanceof p))return new p(e,t);u.call(this),e&&e.constructor==Object?(t=e,e=undefined):e&&(e=e.toString()),t=h.extend({debug:0,host:h.CLOUD_HOST,port:h.CLOUD_PORT,key:"peerjs",config:h.defaultConfig},t),this.options=t,t.host==="/"&&(t.host=window.location.hostname),t.secure===undefined&&t.host!==h.CLOUD_HOST&&(t.secure=h.isSecure()),t.logFunction&&h.setLogFunction(t.logFunction),h.setLogLevel(t.debug);if(!h.supports.audioVideo&&!h.supports.data){this._delayedAbort("browser-incompatible","The current browser does not support WebRTC");return}if(!h.validateId(e)){this._delayedAbort("invalid-id",'ID "'+e+'" is invalid');return}if(!h.validateKey(t.key)){this._delayedAbort("invalid-key",'API KEY "'+t.key+'" is invalid');return}if(t.secure&&t.host==="0.peerjs.com"){this._delayedAbort("ssl-unavailable","The cloud server currently does not support HTTPS. Please run your own PeerServer to use HTTPS.");return}this.destroyed=!1,this.disconnected=!1,this.open=!1,this.connections={},this._lostMessages={};var n=this;this.socket=new g(this.options.secure,this.options.host,this.options.port,this.options.key),this.socket.on("message",function(e){n._handleMessage(e)}),this.socket.on("error",function(e){n._abort("socket-error",e)}),this.socket.on("close",function(){n.disconnected||n._abort("socket-closed","Underlying socket is already closed.")}),e?this._initialize(e):this._retrieveId()}function d(e,t,n){if(!(this instanceof d))return new d(e,t,n);u.call(this),this.options=h.extend({serialization:"binary",reliable:!1},n),this.open=!1,this.type="data",this.peer=e,this.provider=t,this.id=this.options.connectionId||d._idPrefix+h.randomToken(),this.label=this.options.label||this.id,this.metadata=this.options.metadata,this.serialization=this.options.serialization,this.reliable=this.options.reliable,this._buffer=[],this._buffering=!1,this.bufferSize=0,this._chunkedData={},this.options._payload&&(this._peerBrowser=this.options._payload.browser),m.startConnection(this,this.options._payload||{originator:!0})}function v(e,t,n){if(!(this instanceof v))return new v(e,t,n);u.call(this),this.options=h.extend({},n),this.open=!1,this.type="media",this.peer=e,this.provider=t,this.metadata=this.options.metadata,this.localStream=this.options._stream,this.id=this.options.connectionId||v._idPrefix+h.randomToken(),this.localStream&&m.startConnection(this,{_stream:this.localStream,originator:!0})}function g(e,t,n,r){if(!(this instanceof g))return new g(e,t,n,r);u.call(this),this.disconnected=!1,this._queue=[],this._httpUrl=t+"/"+r,this._wsUrl=t.replace(/^http/,"ws")+"/peerjs?key="+r}var t={};t.useBlobBuilder=function(){try{return new Blob([]),!1}catch(e){return!0}}(),t.useArrayBufferView=!t.useBlobBuilder&&function(){try{return(new Blob([new Uint8Array([])])).size===0}catch(e){return!0}}(),e.binaryFeatures=t,e.BlobBuilder=window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder||window.BlobBuilder,n.prototype.append=function(e){typeof e=="number"?this._pieces.push(e):(this.flush(),this._parts.push(e))},n.prototype.flush=function(){if(this._pieces.length>0){var e=new Uint8Array(this._pieces);t.useArrayBufferView||(e=e.buffer),this._parts.push(e),this._pieces=[]}},n.prototype.getBuffer=function(){this.flush();if(t.useBlobBuilder){var e=new BlobBuilder;for(var n=0,r=this._parts.length;n<r;n++)e.append(this._parts[n]);return e.getBlob()}return new Blob(this._parts)},e.BinaryPack={unpack:function(e){var t=new r(e);return t.unpack()},pack:function(e){var t=new i;t.pack(e);var n=t.getBuffer();return n}},r.prototype.unpack=function(){var e=this.unpack_uint8();if(e<128){var t=e;return t}if((e^224)<32){var n=(e^224)-32;return n}var r;if((r=e^160)<=15)return this.unpack_raw(r);if((r=e^176)<=15)return this.unpack_string(r);if((r=e^144)<=15)return this.unpack_array(r);if((r=e^128)<=15)return this.unpack_map(r);switch(e){case 192:return null;case 193:return undefined;case 194:return!1;case 195:return!0;case 202:return this.unpack_float();case 203:return this.unpack_double();case 204:return this.unpack_uint8();case 205:return this.unpack_uint16();case 206:return this.unpack_uint32();case 207:return this.unpack_uint64();case 208:return this.unpack_int8();case 209:return this.unpack_int16();case 210:return this.unpack_int32();case 211:return this.unpack_int64();case 212:return undefined;case 213:return undefined;case 214:return undefined;case 215:return undefined;case 216:return r=this.unpack_uint16(),this.unpack_string(r);case 217:return r=this.unpack_uint32(),this.unpack_string(r);case 218:return r=this.unpack_uint16(),this.unpack_raw(r);case 219:return r=this.unpack_uint32(),this.unpack_raw(r);case 220:return r=this.unpack_uint16(),this.unpack_array(r);case 221:return r=this.unpack_uint32(),this.unpack_array(r);case 222:return r=this.unpack_uint16(),this.unpack_map(r);case 223:return r=this.unpack_uint32(),this.unpack_map(r)}},r.prototype.unpack_uint8=function(){var e=this.dataView[this.index]&255;return this.index++,e},r.prototype.unpack_uint16=function(){var e=this.read(2),t=(e[0]&255)*256+(e[1]&255);return this.index+=2,t},r.prototype.unpack_uint32=function(){var e=this.read(4),t=((e[0]*256+e[1])*256+e[2])*256+e[3];return this.index+=4,t},r.prototype.unpack_uint64=function(){var e=this.read(8),t=((((((e[0]*256+e[1])*256+e[2])*256+e[3])*256+e[4])*256+e[5])*256+e[6])*256+e[7];return this.index+=8,t},r.prototype.unpack_int8=function(){var e=this.unpack_uint8();return e<128?e:e-256},r.prototype.unpack_int16=function(){var e=this.unpack_uint16();return e<32768?e:e-65536},r.prototype.unpack_int32=function(){var e=this.unpack_uint32();return e<Math.pow(2,31)?e:e-Math.pow(2,32)},r.prototype.unpack_int64=function(){var e=this.unpack_uint64();return e<Math.pow(2,63)?e:e-Math.pow(2,64)},r.prototype.unpack_raw=function(e){if(this.length<this.index+e)throw new Error("BinaryPackFailure: index is out of range "+this.index+" "+e+" "+this.length);var t=this.dataBuffer.slice(this.index,this.index+e);return this.index+=e,t},r.prototype.unpack_string=function(e){var t=this.read(e),n=0,r="",i,s;while(n<e)i=t[n],i<128?(r+=String.fromCharCode(i),n++):(i^192)<32?(s=(i^192)<<6|t[n+1]&63,r+=String.fromCharCode(s),n+=2):(s=(i&15)<<12|(t[n+1]&63)<<6|t[n+2]&63,r+=String.fromCharCode(s),n+=3);return this.index+=e,r},r.prototype.unpack_array=function(e){var t=new Array(e);for(var n=0;n<e;n++)t[n]=this.unpack();return t},r.prototype.unpack_map=function(e){var t={};for(var n=0;n<e;n++){var r=this.unpack(),i=this.unpack();t[r]=i}return t},r.prototype.unpack_float=function(){var e=this.unpack_uint32(),t=e>>31,n=(e>>23&255)-127,r=e&8388607|8388608;return(t==0?1:-1)*r*Math.pow(2,n-23)},r.prototype.unpack_double=function(){var e=this.unpack_uint32(),t=this.unpack_uint32(),n=e>>31,r=(e>>20&2047)-1023,i=e&1048575|1048576,s=i*Math.pow(2,r-20)+t*Math.pow(2,r-52);return(n==0?1:-1)*s},r.prototype.read=function(e){var t=this.index;if(t+e<=this.length)return this.dataView.subarray(t,t+e);throw new Error("BinaryPackFailure: read index out of range")},i.prototype.getBuffer=function(){return this.bufferBuilder.getBuffer()},i.prototype.pack=function(e){var n=typeof e;if(n=="string")this.pack_string(e);else if(n=="number")Math.floor(e)===e?this.pack_integer(e):this.pack_double(e);else if(n=="boolean")e===!0?this.bufferBuilder.append(195):e===!1&&this.bufferBuilder.append(194);else if(n=="undefined")this.bufferBuilder.append(192);else{if(n!="object")throw new Error('Type "'+n+'" not yet supported');if(e===null)this.bufferBuilder.append(192);else{var r=e.constructor;if(r==Array)this.pack_array(e);else if(r==Blob||r==File)this.pack_bin(e);else if(r==ArrayBuffer)t.useArrayBufferView?this.pack_bin(new Uint8Array(e)):this.pack_bin(e);else if("BYTES_PER_ELEMENT"in e)t.useArrayBufferView?this.pack_bin(new Uint8Array(e.buffer)):this.pack_bin(e.buffer);else if(r==Object)this.pack_object(e);else if(r==Date)this.pack_string(e.toString());else{if(typeof e.toBinaryPack!="function")throw new Error('Type "'+r.toString()+'" not yet supported');this.bufferBuilder.append(e.toBinaryPack())}}}this.bufferBuilder.flush()},i.prototype.pack_bin=function(e){var t=e.length||e.byteLength||e.size;if(t<=15)this.pack_uint8(160+t);else if(t<=65535)this.bufferBuilder.append(218),this.pack_uint16(t);else{if(!(t<=4294967295))throw new Error("Invalid length");this.bufferBuilder.append(219),this.pack_uint32(t)}this.bufferBuilder.append(e)},i.prototype.pack_string=function(e){var t=o(e);if(t<=15)this.pack_uint8(176+t);else if(t<=65535)this.bufferBuilder.append(216),this.pack_uint16(t);else{if(!(t<=4294967295))throw new Error("Invalid length");this.bufferBuilder.append(217),this.pack_uint32(t)}this.bufferBuilder.append(e)},i.prototype.pack_array=function(e){var t=e.length;if(t<=15)this.pack_uint8(144+t);else if(t<=65535)this.bufferBuilder.append(220),this.pack_uint16(t);else{if(!(t<=4294967295))throw new Error("Invalid length");this.bufferBuilder.append(221),this.pack_uint32(t)}for(var n=0;n<t;n++)this.pack(e[n])},i.prototype.pack_integer=function(e){if(-32<=e&&e<=127)this.bufferBuilder.append(e&255);else if(0<=e&&e<=255)this.bufferBuilder.append(204),this.pack_uint8(e);else if(-128<=e&&e<=127)this.bufferBuilder.append(208),this.pack_int8(e);else if(0<=e&&e<=65535)this.bufferBuilder.append(205),this.pack_uint16(e);else if(-32768<=e&&e<=32767)this.bufferBuilder.append(209),this.pack_int16(e);else if(0<=e&&e<=4294967295)this.bufferBuilder.append(206),this.pack_uint32(e);else if(-2147483648<=e&&e<=2147483647)this.bufferBuilder.append(210),this.pack_int32(e);else if(-0x8000000000000000<=e&&e<=0x8000000000000000)this.bufferBuilder.append(211),this.pack_int64(e);else{if(!(0<=e&&e<=0x10000000000000000))throw new Error("Invalid integer");this.bufferBuilder.append(207),this.pack_uint64(e)}},i.prototype.pack_double=function(e){var t=0;e<0&&(t=1,e=-e);var n=Math.floor(Math.log(e)/Math.LN2),r=e/Math.pow(2,n)-1,i=Math.floor(r*Math.pow(2,52)),s=Math.pow(2,32),o=t<<31|n+1023<<20|i/s&1048575,u=i%s;this.bufferBuilder.append(203),this.pack_int32(o),this.pack_int32(u)},i.prototype.pack_object=function(e){var t=Object.keys(e),n=t.length;if(n<=15)this.pack_uint8(128+n);else if(n<=65535)this.bufferBuilder.append(222),this.pack_uint16(n);else{if(!(n<=4294967295))throw new Error("Invalid length");this.bufferBuilder.append(223),this.pack_uint32(n)}for(var r in e)e.hasOwnProperty(r)&&(this.pack(r),this.pack(e[r]))},i.prototype.pack_uint8=function(e){this.bufferBuilder.append(e)},i.prototype.pack_uint16=function(e){this.bufferBuilder.append(e>>8),this.bufferBuilder.append(e&255)},i.prototype.pack_uint32=function(e){var t=e&4294967295;this.bufferBuilder.append((t&4278190080)>>>24),this.bufferBuilder.append((t&16711680)>>>16),this.bufferBuilder.append((t&65280)>>>8),this.bufferBuilder.append(t&255)},i.prototype.pack_uint64=function(e){var t=e/Math.pow(2,32),n=e%Math.pow(2,32);this.bufferBuilder.append((t&4278190080)>>>24),this.bufferBuilder.append((t&16711680)>>>16),this.bufferBuilder.append((t&65280)>>>8),this.bufferBuilder.append(t&255),this.bufferBuilder.append((n&4278190080)>>>24),this.bufferBuilder.append((n&16711680)>>>16),this.bufferBuilder.append((n&65280)>>>8),this.bufferBuilder.append(n&255)},i.prototype.pack_int8=function(e){this.bufferBuilder.append(e&255)},i.prototype.pack_int16=function(e){this.bufferBuilder.append((e&65280)>>8),this.bufferBuilder.append(e&255)},i.prototype.pack_int32=function(e){this.bufferBuilder.append(e>>>24&255),this.bufferBuilder.append((e&16711680)>>>16),this.bufferBuilder.append((e&65280)>>>8),this.bufferBuilder.append(e&255)},i.prototype.pack_int64=function(e){var t=Math.floor(e/Math.pow(2,32)),n=e%Math.pow(2,32);this.bufferBuilder.append((t&4278190080)>>>24),this.bufferBuilder.append((t&16711680)>>>16),this.bufferBuilder.append((t&65280)>>>8),this.bufferBuilder.append(t&255),this.bufferBuilder.append((n&4278190080)>>>24),this.bufferBuilder.append((n&16711680)>>>16),this.bufferBuilder.append((n&65280)>>>8),this.bufferBuilder.append(n&255)};var a=Array.isArray;u.prototype.addListener=function(e,t,n,r){if("function"!=typeof t)throw new Error("addListener only takes instances of Function");return this.emit("newListener",e,typeof t.listener=="function"?t.listener:t),this._events[e]?a(this._events[e])?this._events[e].push(t):this._events[e]=[this._events[e],t]:this._events[e]=t,this},u.prototype.on=u.prototype.addListener,u.prototype.once=function(e,t,n){function i(){r.removeListener(e,i),t.apply(this,arguments)}if("function"!=typeof t)throw new Error(".once only takes instances of Function");var r=this;return i.listener=t,r.on(e,i),this},u.prototype.removeListener=function(e,t,n){if("function"!=typeof t)throw new Error("removeListener only takes instances of Function");if(!this._events[e])return this;var r=this._events[e];if(a(r)){var i=-1;for(var s=0,o=r.length;s<o;s++)if(r[s]===t||r[s].listener&&r[s].listener===t){i=s;break}if(i<0)return this;r.splice(i,1),r.length==0&&delete this._events[e]}else(r===t||r.listener&&r.listener===t)&&delete this._events[e];return this},u.prototype.off=u.prototype.removeListener,u.prototype.removeAllListeners=function(e){return arguments.length===0?(this._events={},this):(e&&this._events&&this._events[e]&&(this._events[e]=null),this)},u.prototype.listeners=function(e){return this._events[e]||(this._events[e]=[]),a(this._events[e])||(this._events[e]=[this._events[e]]),this._events[e]},u.prototype.emit=function(e){var e=arguments[0],t=this._events[e];if(!t)return!1;if(typeof t=="function"){switch(arguments.length){case 1:t.call(this);break;case 2:t.call(this,arguments[1]);break;case 3:t.call(this,arguments[1],arguments[2]);break;default:var n=arguments.length,r=new Array(n-1);for(var i=1;i<n;i++)r[i-1]=arguments[i];t.apply(this,r)}return!0}if(a(t)){var n=arguments.length,r=new Array(n-1);for(var i=1;i<n;i++)r[i-1]=arguments[i];var s=t.slice();for(var i=0,n=s.length;i<n;i++)s[i].apply(this,r);return!0}return!1},f.prototype.send=function(e){var t=h.pack(e);if(t.size<this._mtu){this._handleSend(["no",t]);return}this._outgoing[this._count]={ack:0,chunks:this._chunk(t)},h.debug&&(this._outgoing[this._count].timer=new Date),this._sendWindowedChunks(this._count),this._count+=1},f.prototype._setupInterval=function(){var e=this;this._timeout=setInterval(function(){var t=e._queue.shift();if(t._multiple)for(var n=0,r=t.length;n<r;n+=1)e._intervalSend(t[n]);else e._intervalSend(t)},this._interval)},f.prototype._intervalSend=function(e){var t=this;e=h.pack(e),h.blobToBinaryString(e,function(e){t._dc.send(e)}),t._queue.length===0&&(clearTimeout(t._timeout),t._timeout=null)},f.prototype._processAcks=function(){for(var e in this._outgoing)this._outgoing.hasOwnProperty(e)&&this._sendWindowedChunks(e)},f.prototype._handleSend=function(e){var t=!0;for(var n=0,r=this._queue.length;n<r;n+=1){var i=this._queue[n];i===e?t=!1:i._multiple&&i.indexOf(e)!==-1&&(t=!1)}t&&(this._queue.push(e),this._timeout||this._setupInterval())},f.prototype._setupDC=function(){var e=this;this._dc.onmessage=function(t){var n=t.data,r=n.constructor;if(r===String){var i=h.binaryStringToArrayBuffer(n);n=h.unpack(i),e._handleMessage(n)}}},f.prototype._handleMessage=function(e){var t=e[1],n=this._incoming[t],r=this._outgoing[t],i;switch(e[0]){case"no":var s=t;!s||this.onmessage(h.unpack(s));break;case"end":i=n,this._received[t]=e[2];if(!i)break;this._ack(t);break;case"ack":i=r;if(!!i){var o=e[2];i.ack=Math.max(o,i.ack),i.ack>=i.chunks.length?(h.log("Time: ",new Date-i.timer),delete this._outgoing[t]):this._processAcks()}break;case"chunk":i=n;if(!i){var u=this._received[t];if(u===!0)break;i={ack:["ack",t,0],chunks:[]},this._incoming[t]=i}var a=e[2],f=e[3];i.chunks[a]=new Uint8Array(f),a===i.ack[2]&&this._calculateNextAck(t),this._ack(t);break;default:this._handleSend(e)}},f.prototype._chunk=function(e){var t=[],n=e.size,r=0;while(r<n){var i=Math.min(n,r+this._mtu),s=e.slice(r,i),o={payload:s};t.push(o),r=i}return h.log("Created",t.length,"chunks."),t},f.prototype._ack=function(e){var t=this._incoming[e].ack;this._received[e]===t[2]&&(this._complete(e),this._received[e]=!0),this._handleSend(t)},f.prototype._calculateNextAck=function(e){var t=this._incoming[e],n=t.chunks;for(var r=0,i=n.length;r<i;r+=1)if(n[r]===undefined){t.ack[2]=r;return}t.ack[2]=n.length},f.prototype._sendWindowedChunks=function(e){h.log("sendWindowedChunks for: ",e);var t=this._outgoing[e],n=t.chunks,r=[],i=Math.min(t.ack+this._window,n.length);for(var s=t.ack;s<i;s+=1)if(!n[s].sent||s===t.ack)n[s].sent=!0,r.push(["chunk",e,s,n[s].payload]);t.ack+this._window>=n.length&&r.push(["end",e,n.length]),r._multiple=!0,this._handleSend(r)},f.prototype._complete=function(e){h.log("Completed called for",e);var t=this,n=this._incoming[e].chunks,r=new Blob(n);h.blobToArrayBuffer(r,function(e){t.onmessage(h.unpack(e))}),delete this._incoming[e]},f.higherBandwidthSDP=function(e){var t=navigator.appVersion.match(/Chrome\/(.*?) /);if(t){t=parseInt(t[1].split(".").shift());if(t<31){var n=e.split("b=AS:30"),r="b=AS:102400";if(n.length>1)return n[0]+r+n[1]}}return e},f.prototype.onmessage=function(e){},e.Reliable=f,e.RTCSessionDescription=window.mozRTCSessionDescription||window.RTCSessionDescription,e.RTCPeerConnection=window.mozRTCPeerConnection||window.webkitRTCPeerConnection||window.RTCPeerConnection,e.RTCIceCandidate=window.mozRTCIceCandidate||window.RTCIceCandidate;var l={iceServers:[{url:"stun:stun.l.google.com:19302"}]},c=1,h={noop:function(){},CLOUD_HOST:"0.peerjs.com",CLOUD_PORT:9e3,chunkedBrowsers:{Chrome:1},chunkedMTU:16300,logLevel:0,setLogLevel:function(e){var t=parseInt(e,10);isNaN(parseInt(e,10))?h.logLevel=e?3:0:h.logLevel=t,h.log=h.warn=h.error=h.noop,h.logLevel>0&&(h.error=h._printWith("ERROR")),h.logLevel>1&&(h.warn=h._printWith("WARNING")),h.logLevel>2&&(h.log=h._print)},setLogFunction:function(e){e.constructor!==Function?h.warn("The log function you passed in is not a function. Defaulting to regular logs."):h._print=e},_printWith:function(e){return function(){var t=Array.prototype.slice.call(arguments);t.unshift(e),h._print.apply(h,t)}},_print:function(){var e=!1,t=Array.prototype.slice.call(arguments);t.unshift("PeerJS: ");for(var n=0,r=t.length;n<r;n++)t[n]instanceof Error&&(t[n]="("+t[n].name+") "+t[n].message,e=!0);e?console.error.apply(console,t):console.log.apply(console,t),document.getElementById("console-log")&&(document.getElementById("console-log").value+=t+"\n")},defaultConfig:l,browser:function(){return window.mozRTCPeerConnection?"Firefox":window.webkitRTCPeerConnection?"Chrome":window.RTCPeerConnection?"Supported":"Unsupported"}(),supports:function(){if(typeof RTCPeerConnection=="undefined")return{};var e=!0,t=!0,n=!1,r=!1,i=!!window.webkitRTCPeerConnection,s,o;try{s=new RTCPeerConnection(l,{optional:[{RtpDataChannels:!0}]})}catch(u){e=!1,t=!1}if(e)try{o=s.createDataChannel("_PEERJSTEST")}catch(u){e=!1}if(e){try{o.binaryType="blob",n=!0}catch(u){}var a=new RTCPeerConnection(l,{});try{var f=a.createDataChannel("_PEERJSRELIABLETEST",{});r=f.reliable}catch(u){}a.close()}t&&(t=!!s.addStream);if(!i&&e){var c=new RTCPeerConnection(l,{optional:[{RtpDataChannels:!0}]});c.onnegotiationneeded=function(){i=!0,h&&h.supports&&(h.supports.onnegotiationneeded=!0)};var p=c.createDataChannel("_PEERJSNEGOTIATIONTEST");setTimeout(function(){c.close()},1e3)}return s&&s.close(),{audioVideo:t,data:e,binaryBlob:n,binary:r,reliable:r,sctp:r,onnegotiationneeded:i}}(),validateId:function(e){return!e||/^[A-Za-z0-9]+(?:[ _-][A-Za-z0-9]+)*$/.exec(e)},validateKey:function(e){return!e||/^[A-Za-z0-9]+(?:[ _-][A-Za-z0-9]+)*$/.exec(e)},debug:!1,inherits:function(e,t){e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}})},extend:function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);return e},pack:BinaryPack.pack,unpack:BinaryPack.unpack,log:function(){if(h.debug){var e=!1,t=Array.prototype.slice.call(arguments);t.unshift("PeerJS: ");for(var n=0,r=t.length;n<r;n++)t[n]instanceof Error&&(t[n]="("+t[n].name+") "+t[n].message,e=!0);e?console.error.apply(console,t):console.log.apply(console,t),document.getElementById("console-log")&&(document.getElementById("console-log").value+=t+"\n")}},setZeroTimeout:function(e){function r(r){t.push(r),e.postMessage(n,"*")}function i(r){r.source==e&&r.data==n&&(r.stopPropagation&&r.stopPropagation(),t.length&&t.shift()())}var t=[],n="zero-timeout-message";return e.addEventListener?e.addEventListener("message",i,!0):e.attachEvent&&e.attachEvent("onmessage",i),r}(this),chunk:function(e){var t=[],n=e.size,r=index=0,i=Math.ceil(n/h.chunkedMTU);while(r<n){var s=Math.min(n,r+h.chunkedMTU),o=e.slice(r,s),u={__peerData:c,n:index,data:o,total:i};t.push(u),r=s,index+=1}return c+=1,t},blobToArrayBuffer:function(e,t){var n=new FileReader;n.onload=function(e){t(e.target.result)},n.readAsArrayBuffer(e)},blobToBinaryString:function(e,t){var n=new FileReader;n.onload=function(e){t(e.target.result)},n.readAsBinaryString(e)},binaryStringToArrayBuffer:function(e){var t=new Uint8Array(e.length);for(var n=0;n<e.length;n++)t[n]=e.charCodeAt(n)&255;return t.buffer},randomToken:function(){return Math.random().toString(36).substr(2)},isSecure:function(){return location.protocol==="https:"}};e.util=h,h.inherits(p,u),p.prototype._retrieveId=function(e){var t=this,n=new XMLHttpRequest,r=this.options.host+"/"+this.options.key+"/id",i="?ts="+(new Date).getTime()+""+Math.random();r+=i,n.open("get",r,!0),n.onerror=function(e){h.error("Error retrieving ID",e),t._abort("server-error","Could not get an ID from the server")},n.onreadystatechange=function(){if(n.readyState!==4)return;if(n.status!==200){n.onerror();return}t._initialize(n.responseText)},n.send(null)},p.prototype._initialize=function(e){var t=this;this.id=e,this.socket.start(this.id)},p.prototype._handleMessage=function(e){var t=e.type,n=e.payload,r=e.src;switch(t){case"OPEN":this.emit("open",this.id),this.open=!0;break;case"ERROR":this._abort("server-error",n.msg);break;case"ID-TAKEN":this._abort("unavailable-id","ID `"+this.id+"` is taken");break;case"INVALID-KEY":this._abort("invalid-key",'API KEY "'+this.options.key+'" is invalid');break;case"LEAVE":h.log("Received leave message from",r),this._cleanupPeer(r);break;case"EXPIRE":this.emit("error",new Error("Could not connect to peer "+r));break;case"OFFER":var i=n.connectionId,s=this.getConnection(r,i);if(s)h.warn("Offer received for existing Connection ID:",i);else{if(n.type==="media"){var s=new v(r,this,{connectionId:i,_payload:n,metadata:n.metadata});this._addConnection(r,s),this.emit("call",s)}else{if(n.type!=="data"){h.warn("Received malformed connection type:",n.type);return}s=new d(r,this,{connectionId:i,_payload:n,metadata:n.metadata,label:n.label,serialization:n.serialization,reliable:n.reliable}),this._addConnection(r,s),this.emit("connection",s)}var o=this._getMessages(i);for(var u=0,a=o.length;u<a;u+=1)s.handleMessage(o[u])}break;default:if(!n){h.warn("You received a malformed message from "+r+" of type "+t);return}var f=n.connectionId,s=this.getConnection(r,f);s&&s.pc?s.handleMessage(e):f?this._storeMessage(f,e):h.warn("You received an unrecognized message:",e)}},p.prototype._storeMessage=function(e,t){this._lostMessages[e]||(this._lostMessages[e]=[]),this._lostMessages[e].push(t)},p.prototype._getMessages=function(e){var t=this._lostMessages[e];return t?(delete this._lostMessages[e],t):[]},p.prototype.connect=function(e,t){if(this.disconnected){h.warn("You cannot connect to a new Peer because you called .disconnect() on this Peer and ended your connection with the server. You can create a new Peer to reconnect."),this.emit("error",new Error("Cannot connect to new Peer after disconnecting from server."));return}var n=new d(e,this,t);return this._addConnection(e,n),n},p.prototype.call=function(e,t,n){if(this.disconnected){h.warn("You cannot connect to a new Peer because you called .disconnect() on this Peer and ended your connection with the server. You can create a new Peer to reconnect."),this.emit("error",new Error("Cannot connect to new Peer after disconnecting from server."));return}if(!t){h.error("To call a peer, you must provide a stream from your browser's `getUserMedia`.");return}n=n||{},n._stream=t;var r=new v(e,this,n);return this._addConnection(e,r),r},p.prototype._addConnection=function(e,t){this.connections[e]||(this.connections[e]=[]),this.connections[e].push(t)},p.prototype.getConnection=function(e,t){var n=this.connections[e];if(!n)return null;for(var r=0,i=n.length;r<i;r++)if(n[r].id===t)return n[r];return null},p.prototype._delayedAbort=function(e,t){var n=this;h.setZeroTimeout(function(){n._abort(e,t)})},p.prototype._abort=function(e,t){h.error("Aborting. Error:",t);var n=new Error(t);n.type=e,this.destroy(),this.emit("error",n)},p.prototype.destroy=function(){this.destroyed||(this._cleanup(),this.disconnect(),this.destroyed=!0)},p.prototype._cleanup=function(){if(this.connections){var e=Object.keys(this.connections);for(var t=0,n=e.length;t<n;t++)this._cleanupPeer(e[t])}this.emit("close")},p.prototype._cleanupPeer=function(e){var t=this.connections[e];for(var n=0,r=t.length;n<r;n+=1)t[n].close()},p.prototype.disconnect=function(){var e=this;h.setZeroTimeout(function(){e.disconnected||(e.disconnected=!0,e.open=!1,e.socket&&e.socket.close(),e.id=null)})},e.Peer=p,h.inherits(d,u),d._idPrefix="dc_",d.prototype.initialize=function(e){this._dc=this.dataChannel=e,this._configureDataChannel()},d.prototype._configureDataChannel=function(){var e=this;h.supports.sctp&&(this._dc.binaryType="arraybuffer"),this._dc.onopen=function(){h.log("Data channel connection success"),e.open=!0,e.emit("open")},!h.supports.sctp&&this.reliable&&(this._reliable=new f(this._dc,h.debug)),this._reliable?this._reliable.onmessage=function(t){e.emit("data",t)}:this._dc.onmessage=function(t){e._handleDataMessage(t)},this._dc.onclose=function(t){h.log("DataChannel closed for:",e.peer),e.close()}},d.prototype._handleDataMessage=function(e){var t=this,n=e.data,r=n.constructor;if(this.serialization==="binary"||this.serialization==="binary-utf8"){if(r===Blob){h.blobToArrayBuffer(n,function(e){n=h.unpack(e),t.emit("data",n)});return}if(r===ArrayBuffer)n=h.unpack(n);else if(r===String){var i=h.binaryStringToArrayBuffer(n);n=h.unpack(i)}}else this.serialization==="json"&&(n=JSON.parse(n));if(n.__peerData){var s=n.__peerData,o=this._chunkedData[s]||{data:[],count:0,total:n.total};o.data[n.n]=n.data,o.count+=1,o.total===o.count&&(n=new Blob(o.data),this._handleDataMessage({data:n}),delete this._chunkedData[s]),this._chunkedData[s]=o;return}this.emit("data",n)},d.prototype.close=function(){if(!this.open)return;this.open=!1,m.cleanup(this),this.emit("close")},d.prototype.send=function(e,t){if(!this.open){this.emit("error",new Error("Connection is not open. You should listen for the `open` event before sending messages."));return}if(this._reliable){this._reliable.send(e);return}var n=this;if(this.serialization==="json")this._bufferedSend(JSON.stringify(e));else if(this.serialization==="binary"||this.serialization==="binary-utf8"){var r=h.pack(e),i=h.chunkedBrowsers[this._peerBrowser]||h.chunkedBrowsers[h.browser];if(i&&!t&&r.size>h.chunkedMTU){this._sendChunks(r);return}h.supports.sctp?h.supports.binaryBlob?this._bufferedSend(r):h.blobToArrayBuffer(r,function(e){n._bufferedSend(e)}):h.blobToBinaryString(r,function(e){n._bufferedSend(e)})}else this._bufferedSend(e)},d.prototype._bufferedSend=function(e){if(this._buffering||!this._trySend(e))this._buffer.push(e),this.bufferSize=this._buffer.length},d.prototype._trySend=function(e){try{this._dc.send(e)}catch(t){this._buffering=!0;var n=this;return setTimeout(function(){n._buffering=!1,n._tryBuffer()},100),!1}return!0},d.prototype._tryBuffer=function(){if(this._buffer.length===0)return;var e=this._buffer[0];this._trySend(e)&&(this._buffer.shift(),this.bufferSize=this._buffer.length,this._tryBuffer())},d.prototype._sendChunks=function(e){var t=h.chunk(e);for(var n=0,r=t.length;n<r;n+=1){var e=t[n];this.send(e,!0)}},d.prototype.handleMessage=function(e){var t=e.payload;switch(e.type){case"ANSWER":this._peerBrowser=t.browser,m.handleSDP(e.type,this,t.sdp);break;case"CANDIDATE":m.handleCandidate(this,t.candidate);break;default:h.warn("Unrecognized message type:",e.type,"from peer:",this.peer)}},h.inherits(v,u),v._idPrefix="mc_",v.prototype.addStream=function(e){h.log("Receiving stream",e),this.remoteStream=e,this.emit("stream",e)},v.prototype.handleMessage=function(e){var t=e.payload;switch(e.type){case"ANSWER":m.handleSDP(e.type,this,t.sdp),this.open=!0;break;case"CANDIDATE":m.handleCandidate(this,t.candidate);break;default:h.warn("Unrecognized message type:",e.type,"from peer:",this.peer)}},v.prototype.answer=function(e){if(this.localStream){h.warn("Local stream already exists on this MediaConnection. Are you answering a call twice?");return}this.options._payload._stream=e,this.localStream=e,m.startConnection(this,this.options._payload);var t=this.provider._getMessages(this.id);for(var n=0,r=t.length;n<r;n+=1)this.handleMessage(t[n]);this.open=!0},v.prototype.close=function(){if(!this.open)return;this.open=!1,m.cleanup(this),this.emit("close")};var m={pcs:{data:{},media:{}},queue:[]};m._idPrefix="pc_",m.startConnection=function(e,t){var n=m._getPeerConnection(e,t);e.type==="media"&&t._stream&&n.addStream(t._stream),e.pc=n;if(t.originator){if(e.type==="data"){var r={};h.supports.sctp||(r={reliable:t.reliable});var i=n.createDataChannel(e.label,r);e.initialize(i)}h.supports.onnegotiationneeded||m._makeOffer(e)}else m.handleSDP("OFFER",e,t.sdp)},m._getPeerConnection=function(e,t){m.pcs[e.type]||h.error(e.type+" is not a valid connection type. Maybe you overrode the `type` property somewhere."),m.pcs[e.type][e.peer]||(m.pcs[e.type][e.peer]={});var n=m.pcs[e.type][e.peer],r;t.pc&&(r=m.pcs[e.type][e.peer][t.pc]);if(!r||r.signalingState!=="stable")r=m._startPeerConnection(e);return r},m._startPeerConnection=function(e){h.log("Creating RTCPeerConnection.");var t=m._idPrefix+h.randomToken(),n={};e.type==="data"&&!h.supports.sctp?n={optional:[{RtpDataChannels:!0}]}:e.type==="media"&&(n={optional:[{DtlsSrtpKeyAgreement:!0}]});var r=new RTCPeerConnection(e.provider.options.config,n);return m.pcs[e.type][e.peer][t]=r,m._setupListeners(e,r,t),r},m._setupListeners=function(e,t,n){var r=e.peer,i=e.id,s=e.provider;h.log("Listening for ICE candidates."),t.onicecandidate=function(t){t.candidate&&(h.log("Received ICE candidates for:",e.peer),s.socket.send({type:"CANDIDATE",payload:{candidate:t.candidate,type:e.type,connectionId:e.id},dst:r}))},t.oniceconnectionstatechange=function(){switch(t.iceConnectionState){case"disconnected":case"failed":h.log("iceConnectionState is disconnected, closing connections to "+r),e.close();break;case"completed":t.onicecandidate=h.noop}},t.onicechange=t.oniceconnectionstatechange,h.log("Listening for `negotiationneeded`"),t.onnegotiationneeded=function(){h.log("`negotiationneeded` triggered"),t.signalingState=="stable"?m._makeOffer(e):h.log("onnegotiationneeded triggered when not stable. Is another connection being established?")},h.log("Listening for data channel"),t.ondatachannel=function(e){h.log("Received data channel");var t=e.channel,n=s.getConnection(r,i);n.initialize(t)},h.log("Listening for remote stream"),t.onaddstream=function(e){h.log("Received remote stream");var t=e.stream;s.getConnection(r,i).addStream(t)}},m.cleanup=function(e){h.log("Cleaning up PeerConnection to "+e.peer);var t=e.pc;!!t&&(t.readyState!=="closed"||t.signalingState!=="closed")&&(t.close(),e.pc=null)},m._makeOffer=function(e){var t=e.pc;t.createOffer(function(n){h.log("Created offer."),!h.supports.sctp&&e.type==="data"&&e.reliable&&(n.sdp=f.higherBandwidthSDP(n.sdp)),t.setLocalDescription(n,function(){h.log("Set localDescription: offer","for:",e.peer),e.provider.socket.send({type:"OFFER",payload:{sdp:n,type:e.type,label:e.label,connectionId:e.id,reliable:e.reliable,serialization:e.serialization,metadata:e.metadata,browser:h.browser},dst:e.peer})},function(t){e.provider.emit("error",t),h.log("Failed to setLocalDescription, ",t)})},function(t){e.provider.emit("error",t),h.log("Failed to createOffer, ",t)},e.options.constraints)},m._makeAnswer=function(e){var t=e.pc;t.createAnswer(function(n){h.log("Created answer."),!h.supports.sctp&&e.type==="data"&&e.reliable&&(n.sdp=f.higherBandwidthSDP(n.sdp)),t.setLocalDescription(n,function(){h.log("Set localDescription: answer","for:",e.peer),e.provider.socket.send({type:"ANSWER",payload:{sdp:n,type:e.type,connectionId:e.id,browser:h.browser},dst:e.peer})},function(t){e.provider.emit("error",t),h.log("Failed to setLocalDescription, ",t)})},function(t){e.provider.emit("error",t),h.log("Failed to create answer, ",t)})},m.handleSDP=function(e,t,n){n=new RTCSessionDescription(n);var r=t.pc;h.log("Setting remote description",n),r.setRemoteDescription(n,function(){h.log("Set remoteDescription:",e,"for:",t.peer),e==="OFFER"&&m._makeAnswer(t)},function(e){t.provider.emit("error",e),h.log("Failed to setRemoteDescription, ",e)})},m.handleCandidate=function(e,t){var n=t.candidate,r=t.sdpMLineIndex;e.pc.addIceCandidate(new RTCIceCandidate({sdpMLineIndex:r,candidate:n})),h.log("Added ICE candidate for:",e.peer)},h.inherits(g,u),g.prototype.start=function(e){this.id=e;var t=h.randomToken();this._httpUrl+="/"+e+"/"+t,this._wsUrl+="&id="+e+"&token="+t,this._startXhrStream(),this._startWebSocket()},g.prototype._startWebSocket=function(e){var t=this;if(this._socket)return;this._socket=new WebSocket(this._wsUrl),this._socket.onmessage=function(e){var n;try{n=JSON.parse(e.data)}catch(r){h.log("Invalid server message",e.data);return}t.emit("message",n)},this._socket.onopen=function(){t._timeout&&(clearTimeout(t._timeout),setTimeout(function(){t._http.abort(),t._http=null},5e3)),t._sendQueuedMessages(),h.log("Socket open")}},g.prototype._startXhrStream=function(e){try{var t=this;this._http=new XMLHttpRequest,this._http._index=1,this._http._streamIndex=e||0,this._http.open("post",this._httpUrl+"/id?i="+this._http._streamIndex,!0),this._http.onreadystatechange=function(){this.readyState==2&&this.old&&(this.old.abort(),delete this.old),this.readyState>2&&this.status==200&&this.responseText&&t._handleStream(this)},this._http.send(null),this._setHTTPTimeout()}catch(n){h.log("XMLHttpRequest not available; defaulting to WebSockets")}},g.prototype._handleStream=function(e){var t=e.responseText.split("\n");if(e._buffer)while(e._buffer.length>0){var n=e._buffer.shift(),r=t[n];try{r=JSON.parse(r)}catch(i){e._buffer.shift(n);break}this.emit("message",r)}var s=t[e._index];if(s){e._index+=1;if(e._index===t.length)e._buffer||(e._buffer=[]),e._buffer.push(e._index-1);else{try{s=JSON.parse(s)}catch(i){h.log("Invalid server message",s);return}this.emit("message",s)}}},g.prototype._setHTTPTimeout=function(){var e=this;this._timeout=setTimeout(function(){var t=e._http;e._wsOpen()?t.abort():(e._startXhrStream(t._streamIndex+1),e._http.old=t)},25e3)},g.prototype._wsOpen=function(){return this._socket&&this._socket.readyState==1},g.prototype._sendQueuedMessages=function(){for(var e=0,t=this._queue.length;e<t;e+=1)this.send(this._queue[e])},g.prototype.send=function(e){if(this.disconnected)return;if(!this.id){this._queue.push(e);return}if(!e.type){this.emit("error","Invalid message");return}var t=JSON.stringify(e);if(this._wsOpen())this._socket.send(t);else{var n=new XMLHttpRequest,r=this._httpUrl+"/"+e.type.toLowerCase();n.open("post",r,!0),n.setRequestHeader("Content-Type","application/json"),n.send(t)}},g.prototype.close=function(){!this.disconnected&&this._wsOpen()&&(this._socket.close(),this.disconnected=!0)}}(this),define("LFrelease/third_party/peer",function(){}),define("LF/network",["LF/util","F.core/network","LFrelease/third_party/peer"],function(e,t){function s(e,n){t.setInterval(function(t,n,s){if(n&&n.control)for(var o=0;o<i.length;o++)i[o].supply(n.control[o]);var u=[];for(var o=0;o<r.length;o++)u[o]=r[o].pre_fetch();s({control:u}),e();for(var o=0;o<r.length;o++)r[o].swap_buffer()},n)}function o(e,t){this.state={},this.child=[],this.buf=[],this.pre_buf=[],this.sync=!0,this.role=e;if(e==="local"||e==="dual"){r.push(this),this.control=t,this.type=t.type,t.config&&(this.config=t.config),t.keycode&&(this.keycode=t.keycode),t.child.push(this),t.sync=!0;for(var n in t.state)this.state[n]=0}if(e==="remote"||e==="dual"){i.push(this);if(e==="remote")for(var n in t)this.state[n]=0}}var n=e.location_parameters(),r=[],i=[];o.prototype.clear_states=function(){},o.prototype.flush=function(){},o.prototype.pre_fetch=function(){if(this.role==="local"||this.role==="dual")return this.control.fetch(),this.pre_buf},o.prototype.swap_buffer=function(){if(this.role==="local"||this.role==="dual"){var e=this.pre_buf;this.pre_buf=this.buf,this.buf=e}},o.prototype.supply=function(e){(this.role==="remote"||this.role==="dual")&&e&&e.length&&(this.buf=this.buf.concat(e))},o.prototype.fetch=function(){for(var e=0;e<this.buf.length;e++){var t=this.buf[e],n=t[0],r=t[1];for(var i=0;i<this.child.length;i++)this.child[i].key(n,r);this.state[n]=r}this.buf.length=0},o.prototype.key=function(e,t){this.pre_buf.push([e,t])};var u,a="http://localhost:8080";return location.origin==="http://tyt2y3.github.io"&&(a="http://flf-lodge.herokuapp.com"),n.host==="peerjs"&&(a="http://0.peerjs.com",u="skrweclntxi27qfr"),n.pvp&&n.id1&&n.id2?(t.setup_peer(a,n.pvp==="active",n.id1,n.id2,u),{controller:o,setInterval:s,clearInterval:t.clearInterval}):{setInterval:function(e,t){return setInterval(e,t)},clearInterval:function(e){return clearInterval(e)}}}),define("LF/mechanics",["LF/global"],function(e){function n(t){var n=t.match.spec;n[t.id]&&n[t.id].mass!==undefined&&n[t.id].mass!==null?this.mass=n[t.id].mass:this.mass=e.gameplay.default.machanics.mass,this.ps,this.sp=t.sp,this.frame=t.frame,this.parent=t,this.vol_body={0:{},1:{},2:{},3:{},4:{},5:{},length:0,empty_data:{},max:6},this.bg=t.bg,this.sha=t.shadow}var t=e.gameplay;return n.prototype.body=function(e,t,n){var r=this.ps,i=this.sp,s=n;e||(e=this.frame.D.bdy);if(e===this.frame.D.bdy&&this.parent.effect.super)return this.body_empty();if(e!==this.frame.D.bdy||!!t||e instanceof Array&&!(e.length<=this.vol_body.max)){if(e instanceof Array){if(!t&&e.length===2)return[this.volume(e[0],s),this.volume(e[1],s)];if(!t&&e.length===3)return[this.volume(e[0],s),this.volume(e[1],s),this.volume(e[2],s)];var o=[];for(var u in e)(!t||t(e[u]))&&o.push(this.volume(e[u],s));return o}return!t||t(e)?[this.volume(e,s)]:[]}return this.body_body(n)},n.prototype.body_empty=function(){return this.vol_body.length=0,this.vol_body},n.prototype.body_body=function(e){var n=this.frame.D.bdy,r=this.ps,i=this.sp;if(!n){var s=this.vol_body[0];e?(s.x=e.x,s.y=e.y,s.z=e.z):(s.x=r.sx,s.y=r.sy,s.z=r.sz),s.vx=0,s.vy=0,s.w=0,s.h=0,s.zwidth=0,s.data=this.vol_body.empty_data,this.vol_body.length=1}else if(n instanceof Array){for(var o=0;o<n.length;o++){var s=this.vol_body[o],u=n[o].x;r.dir==="left"&&(u=i.w-n[o].x-n[o].w),e?(s.x=r.sx+e.x,s.y=r.sy+e.y,s.z=r.sz+e.z):(s.x=r.sx,s.y=r.sy,s.z=r.sz),s.vx=u,s.vy=n[o].y,s.w=n[o].w,s.h=n[o].h,s.zwidth=n[o].zwidth?n[o].zwidth:t.default.itr.zwidth,s.data=n[o]}this.vol_body.length=n.length}else{var s=this.vol_body[0],u=n.x;r.dir==="left"&&(u=i.w-n.x-n.w),e?(s.x=r.sx+e.x,s.y=r.sy+e.y,s.z=r.sz+e.z):(s.x=r.sx,s.y=r.sy,s.z=r.sz),s.vx=u,s.vy=n.y,s.w=n.w,s.h=n.h,s.zwidth=n.zwidth?n.zwidth:t.default.itr.zwidth,s.data=n,this.vol_body.length=1}return this.vol_body},n.prototype.volume=function(e,n){var r=this.ps,i=this.sp;if(!e)return n?{x:n.x,y:n.y,z:n.z,vx:0,vy:0,w:0,h:0,zwidth:0,data:{}}:{x:r.sx,y:r.sy,z:r.sz,vx:0,vy:0,w:0,h:0,zwidth:0,data:{}};var s=e.x;return r.dir==="left"&&(s=i.w-e.x-e.w),n?{x:r.sx+n.x,y:r.sy+n.y,z:r.sz+n.z,vx:s,vy:e.y,w:e.w,h:e.h,zwidth:e.zwidth?e.zwidth:t.default.itr.zwidth,data:e}:{x:r.sx,y:r.sy,z:r.sz,vx:s,vy:e.y,w:e.w,h:e.h,zwidth:e.zwidth?e.zwidth:t.default.itr.zwidth,data:e}},n.prototype.make_point=function(e,t){var n=this.ps,r=this.sp;return e&&!t?n.dir==="right"?{x:n.sx+e.x,y:n.sy+e.y,z:n.sz+e.y}:{x:n.sx+r.w-e.x,y:n.sy+e.y,z:n.sz+e.y}:e&&t?n.dir==="right"?{x:n.sx+e[t+"x"],y:n.sy+e[t+"y"],z:n.sz+e[t+"y"]}:{x:n.sx+r.w-e[t+"x"],y:n.sy+e[t+"y"],z:n.sz+e[t+"y"]}:(console.log("mechanics: make point failed"),{x:n.sx,y:n.sy,z:n.sz})},n.prototype.coincideXZ=function(e,t){var n=this.ps,r=this.sp,i=this.frame.D,s=e.x-t.x,o=e.z-t.z;n.x+=s,n.z+=o,n.sx=n.dir==="right"?n.x-i.centerx:n.x+i.centerx-r.w},n.prototype.coincideXY=function(e,t){var n=this.ps,r=this.sp,i=this.frame.D,s=e.x-t.x,o=e.y-t.y;n.x+=s,n.y+=o,n.sx=n.dir==="right"?n.x-i.centerx:n.x+i.centerx-r.w,n.sy=n.y-i.centery},n.prototype.create_metric=function(){return this.ps={sx:0,sy:0,sz:0,x:0,y:0,z:0,vx:0,vy:0,vz:0,zz:0,dir:"right",fric:1},this.ps},n.prototype.reset=function(){var e=this.ps;e.sx=0,e.sy=0,e.sz=0,e.x=0,e.y=0,e.z=0,e.vx=0,e.vy=0,e.vz=0,e.zz=0,e.dir="right",e.fric=1},n.prototype.set_pos=function(e,t,n){var r=this.ps,i=this.sp,s=this.frame.D;r.x=e,r.y=t,r.z=n,r.z<this.bg.zboundary[0]&&(r.z=this.bg.zboundary[0]),r.z>this.bg.zboundary[1]&&(r.z=this.bg.zboundary[1]),r.sx=r.dir==="right"?r.x-s.centerx:r.x+s.centerx-i.w,r.sy=t-s.centery,r.sz=n},n.prototype.dynamics=function(){var t=this.ps,n=this.sp,r=this.frame.D,i=e.gameplay;this.blocking_xz()||(t.x+=t.vx,t.z+=t.vz),this.floor_xbound&&(t.x<0&&(t.x=0),t.x>this.bg.width&&(t.x=this.bg.width)),t.z<this.bg.zboundary[0]&&(t.z=this.bg.zboundary[0]),t.z>this.bg.zboundary[1]&&(t.z=this.bg.zboundary[1]),t.y+=t.vy,t.sx=t.dir==="right"?t.x-r.centerx:t.x+r.centerx-n.w,t.sy=t.y-r.centery,t.sz=t.z,t.y>0&&(t.y=0,t.sy=t.y-r.centery),n.set_x_y(Math.floor(t.sx),Math.floor(t.sy+t.sz)),n.set_z(Math.floor(t.sz+t.zz)),this.sha&&(this.sha.set_x_y(Math.floor(t.x-this.bg.shadow.x),Math.floor(t.z-this.bg.shadow.y)),this.sha.set_z(Math.floor(t.sz-1))),t.y===0&&(t.vx&&(t.vx+=(t.vx>0?-1:1)*t.fric),t.vz&&(t.vz+=(t.vz>0?-1:1)*t.fric),t.vx!==0&&t.vx>-i.min_speed&&t.vx<i.min_speed&&(t.vx=0),t.vz!==0&&t.vz>-i.min_speed&&t.vz<i.min_speed&&(t.vz=0)),t.y<0&&(t.vy+=this.mass*i.gravity)},n.prototype.unit_friction=function(){var e=this.ps;e.y===0&&(e.vx&&(e.vx+=e.vx>0?-1:1),e.vz&&(e.vz+=e.vz>0?-1:1))},n.prototype.linear_friction=function(e,t){var n=this.ps;e&&n.vx&&(n.vx+=n.vx>0?-e:e),t&&n.vz&&(n.vz+=n.vz>0?-t:t)},n.prototype.blocking_xz=function(){var e={x:this.ps.vx,y:0,z:this.ps.vz},t=this.body(null,null,e);for(var n=0;n<t.length;n++){t[n].zwidth=0;var r=this.parent.scene.query(t[n],this.parent,{tag:"itr:14"});if(r.length>0)return!0}},n.prototype.project=function(){var e=this.ps,t=this.sp;t.set_x_y(e.sx,e.sy+e.sz),t.set_z(e.sz+e.zz)},n.prototype.speed=function(){var e=this.ps;return Math.sqrt(e.vx*e.vx+e.vy*e.vy)},n}),define("LF/AI",["F.core/util"],function(e){function t(e){this.self=e}function n(){this.state={},this.child=new Array,this.sync=!0,this.buf=new Array}return t.prototype.facing=function(){var e=this.self;return e.ps.dir==="left"},t.prototype.type=function(){var e=this.self;switch(e.type){case"character":return 0;case"lightweapon":return 1;case"heavyweapon":return 2;case"specialattack":return 3;case"baseball":return 4;case"criminal":return 5;case"drink":return 6}},t.prototype.weapon_type=function(){var e=this.self;if(e.hold.obj)switch(e.hold.obj.type){case"lightweapon":return e.proper(e.hold.obj.id,"stand_throw")?101:1;case"heavyweapon":return 2;case"character":return-1*e.AI.type()}return 0},t.prototype.weapon_held=function(){var e=this.self;return e.hold.obj?e.hold.obj.uid:-1},t.prototype.weapon_holder=function(){var e=this.self;if(e.hold.obj)switch(e.AI.type()){case 1:case 2:case 4:case 6:return e.hold.obj.uid}},t.prototype.clone=function(){return-1},t.prototype.blink=function(){var e=this.self;return e.effect.blink?Math.round(e.effect.timeout/2):0},t.prototype.shake=function(){var e=this.self;return e.effect.oscillate?e.effect.timeout*(e.effect.dvx||e.effect.dvy?1:-1):0},t.prototype.ctimer=function(){var e=this.self;return e.catching&&e.state()===9?e.statemem.counter*6:0},t.prototype.seqcheck=function(e){var t=this.self;if(t.combodec){var n=t.combodec.seq;if(n.length<1||e.length<1)return 0;var r=n[n.length-1];if(r===e[0])return 1;if(n.length<2||e.length<2)return 0;var i=n[n.length-2];if(i===e[0]&&r===[1])return 2;if(n.length<3||e.length<3)return 0;var s=n[n.length-3];if(s===e[0]&&i===e[1]&&r===e[2])return 3}return 0},t.prototype.rand=function(e){var t=this.self;return Math.floor(t.match.random()*e)},t.prototype.frame=function(t){var n=this.self,r={bdy:"make_array",itr:"make_array",wpoint:"object"},i={};if(n.data.frame[t])for(var s in n.data.frame[t])if(typeof n.data.frame[t][s]=="object")if(r[s]==="make_array"){var o=e.make_array(n.data.frame[t][s]);i[s+"_count"]=o.length,i[s+"s"]=o}else r[s]==="object"&&(i[s]=n.data.frame[t][s]);else i[s]=n.data.frame[t][s];else for(var u in r)r[u]==="make_array"&&(i[u+"_count"]=0);return i},t.prototype.frame1=function(e){return 0},n.prototype.key=function(e,t){if(this.sync)this.buf.push([e,t]);else{if(this.child)for(var n in this.child)this.child[n].key(e,t);this.state[I]=t}},n.prototype.keypress=function(e,t,n){t===undefined&&n===undefined||t===1&&n===0?(this.state[e]&&this.key(e,0),this.key(e,1),this.key(e,0)):t===1&&n===1?this.state[e]||this.key(e,1):t===0&&n===0&&this.state[e]&&this.key(e,0)},n.prototype.keyseq=function(e){for(var t=0;t<e.length;t++)this.keypress(e[t])},n.prototype.clear_states=function(){for(var e in this.state)this.state[e]=0},n.prototype.fetch=function(){for(var e=0;e<this.buf.length;e++){var t=this.buf[e][0],n=this.buf[e][1];if(this.child)for(var r=0;r<this.child.length;r++)this.child[r].key(t,n);this.state[t]=n}this.buf.length=0},n.prototype.flush=function(){this.buf.length=0},n.prototype.type="AIcontroller",{"interface":t,controller:n}}),define("LF/livingobject",["LF/global","LF/sprite","LF/mechanics","LF/AI","LF/util","F.core/sprite","F.core/util"],function(e,t,n,r,i,s,o){function a(e,i,o){if(!e)return;var u=this;u.name=i.bmp.name,u.uid=-1,u.id=o,u.data=i,u.team=e.team,u.statemem={},u.match=e.match,u.scene=u.match.scene,u.visualeffect=u.match.visualeffect,u.bg=u.match.background,u.sp=new t(i.bmp,u.match.stage);if(!u.proper("no_shadow")){var a={canvas:u.match.stage,wh:"fit",img:u.bg.shadow.img};u.shadow=new s(a)}u.health={hp:100,mp:100},u.frame={PN:0,N:0,D:i.frame[0],ani:{i:0,up:!0}},u.mech=new n(u),u.AI=new r.interface(u),u.ps=u.mech.create_metric(),u.trans=new f(u),u.itr={arest:0,vrest:[]},u.effect={num:-99,dvx:0,dvy:0,stuck:!1,oscillate:0,blink:!1,"super":!1,timein:0,timeout:0},u.catching=0,u.allow_switch_dir=!0}function f(e){var t=1,n=999,r=0,i=1;this.frame=function(e,t){this.set_next(e,t),this.set_wait(0,t)},this.set_wait=function(e,n,s){n||(n=0),n===99&&(n=r),s||(s=1),n>=r&&(r=n,i=s,s===99&&(i=t),t=e,t<0&&(t=0))},this.inc_wait=function(e,n,s){n||(n=0),n===99&&(n=r),s||(s=1),n>=r&&(r=n,i=s,s===99&&(i=t),t+=e,t<0&&(t=0))},this.next=function(){return n},this.wait=function(){return t},this.set_next=function(e,s,o){s||(s=0),s===99&&(s=r),o||(o=1),s>=r&&(r=s,i=o,o===99&&(i=t),n=e)},this.reset_lock=function(e){e||(e=0),e===99&&(e=r),e>=r&&(r=0)},this.next_frame_D=function(){var t=n;return t===999&&(t=0),e.data.frame[t]},this.trans=function(){var s=r;i--,i===0&&(r=0);if(t===0){if(n!==0){if(n===1e3){e.match.destroy_object(e);return}n===999&&(n=0),e.frame.PN=e.frame.N,e.frame.N=n,e.state_update("frame_exit");var o=e.frame.D.state!==e.data.frame[n].state;o&&e.state_update("state_exit"),e.frame.D=e.data.frame[n];if(o){e.statemem={};var u=e.allow_switch_dir;e.states_switch_dir&&e.states_switch_dir[e.frame.D.state]!==undefined?e.allow_switch_dir=e.states_switch_dir[e.frame.D.state]:e.allow_switch_dir=!1,e.state_update("state_entry"),e.allow_switch_dir&&!u&&e.con&&(e.con.state.left&&e.switch_dir("left"),e.con.state.right&&e.switch_dir("right"))}e.frame_update(),(s===10||s===11)&&t>0&&(t-=1)}}else t--}}var u=e.gameplay;return a.prototype.type="livingobject",a.prototype.destroy=function(){this.sp.destroy(),this.shadow.remove()},a.prototype.log=function(e){this.match.log(e)},a.prototype.setup=function(){var e=this;e.state_update("setup")},a.prototype.frame_update=function(){var e=this;e.sp.show_pic(e.frame.D.pic),e.ps.fric=1,e.state_update("frame_force")||e.frame_force(),e.trans.set_wait(e.frame.D.wait,99),e.trans.set_next(e.frame.D.next,99),e.state_update("frame")},a.prototype.frame_force=function(){var e=this;if(e.frame.D.dvx){var t=e.ps.vx>0?e.ps.vx:-e.ps.vx;if(e.ps.y<0||t<e.frame.D.dvx)e.ps.vx=e.dirh()*e.frame.D.dvx;e.frame.D.dvx<0&&(e.ps.vx=e.ps.vx-e.dirh())}e.frame.D.dvz&&(e.ps.vz=e.dirv()*e.frame.D.dvz),e.frame.D.dvy&&(e.ps.vy+=e.frame.D.dvy)},a.prototype.TU_update=function(){var e=this;e.state_update("TU_force")||e.frame_force();if(e.effect.timein<0){if(e.effect.oscillate)e.effect.oi===1?e.effect.oi=-1:e.effect.oi=1,e.sp.set_x_y(e.ps.sx+e.effect.oscillate*e.effect.oi,e.ps.sy+e.ps.sz);else if(e.effect.blink){e.effect.bi===undefined&&(e.effect.bi=0);switch(e.effect.bi%4){case 0:case 1:e.sp.hide();break;case 2:case 3:e.sp.show()}e.effect.bi++}e.effect.timeout===0?(e.effect.num=-99,e.effect.stuck&&(e.effect.stuck=!1),e.effect.oscillate&&(e.effect.oscillate=0,e.sp.set_x_y(e.ps.sx,e.ps.sy+e.ps.sz)),e.effect.blink&&(e.effect.blink=!1,e.effect.bi=undefined,e.sp.show()),e.effect.super&&(e.effect.super=!1)):e.effect.timeout===-1&&(e.effect.dvx&&(e.ps.vx=e.effect.dvx),e.effect.dvy&&(e.ps.vy=e.effect.dvy),e.effect.dvx=0,e.effect.dvy=0),e.effect.timeout--}e.effect.timein<0&&e.effect.stuck||e.state_update("TU");for(var t in e.itr.vrest)e.itr.vrest[t]>0&&e.itr.vrest[t]--;e.itr.arest>0&&e.itr.arest--},a.prototype.state_update=function(e){var t=this,n=t.states.generic;if(n)var r=n.apply(t,arguments);var i=t.states[t.frame.D.state];if(i)var s=i.apply(t,arguments);return r||s},a.prototype.TU=function(){var e=this;e.TU_update(),e.con&&e.combodec.frame()},a.prototype.transit=function(){var e=this;e.con&&e.combo_update(),e.effect.timein<0&&e.effect.stuck||e.trans.trans(),e.effect.timein--,e.effect.timein<0&&e.effect.stuck||e.state_update("transit")},a.prototype.set_pos=function(e,t,n){this.mech.set_pos(e,t,n)},a.prototype.vol_body=function(){return this.mech.body()},a.prototype.state=function(){return this.frame.D.state},a.prototype.effect_id=function(e){return e+u.effect.num_to_id},a.prototype.effect_create=function(e,t,n,r){var i=this;if(e>=i.effect.num){var s=e+u.effect.num_to_id;i.proper(s,"oscillate")&&(i.effect.oscillate=i.proper(s,"oscillate")),i.proper(s,"cant_move")&&(i.effect.stuck=!0),n!==undefined&&(i.effect.dvx=n),r!==undefined&&(i.effect.dvy=r),i.effect.num>=0?(0<i.effect.timein&&(i.effect.timein=0),t>i.effect.timeout&&(i.effect.timeout=t)):(i.effect.timein=0,i.effect.timeout=t),i.effect.num=e}},a.prototype.effect_stuck=function(e,t){var n=this;if(!n.effect.stuck||n.effect.num<=-1)n.effect.num=-1,n.effect.stuck=!0,n.effect.timein=e,n.effect.timeout=t},a.prototype.visualeffect_create=function(e,t,n,r){var i=this,s=e+u.effect.num_to_id,o={x:t.x+t.vx+(n?t.w:0),y:t.y+t.vy+t.h/2,z:t.z>i.ps.z?t.z:i.ps.z};i.visualeffect.create(o,s,r)},a.prototype.frame_ani_oscillate=function(e,t){var n=this,r=n.frame;if(r.ani.i<e||r.ani.i>t)r.ani.up=!0,r.ani.i=e+1;r.ani.i<t&&r.ani.up?n.trans.set_next(r.ani.i++):r.ani.i>e&&!r.ani.up&&n.trans.set_next(r.ani.i--),r.ani.i==t&&(r.ani.up=!1),r.ani.i==e&&(r.ani.up=!0)},a.prototype.frame_ani_sequence=function(e,t){var n=this,r=n.frame;if(r.ani.i<e||r.ani.i>t)r.ani.i=e+1;trans.set_next(r.ani.i++),r.ani.i>t&&(r.ani.i=e)},a.prototype.itr_arest_test=function(){var e=this;return!e.itr.arest},a.prototype.itr_arest_update=function(e){var t=this;e&&e.arest?t.itr.arest=e.arest:t.itr.arest=u.default.character.arest},a.prototype.itr_vrest_test=function(e){var t=this;return!t.itr.vrest[e]},a.prototype.itr_vrest_update=function(e,t){var n=this;t&&t.vrest&&(n.itr.vrest[e]=t.vrest)},a.prototype.switch_dir=function(e){var t=this;t.ps.dir==="left"&&e==="right"?(t.ps.dir="right",t.sp.switch_lr("right")):t.ps.dir==="right"&&e==="left"&&(t.ps.dir="left",t.sp.switch_lr("left"))},a.prototype.dirh=function(){var e=this;return e.ps.dir==="left"?-1:1},a.prototype.dirv=function(){var e=this,t=0;return e.con&&(e.con.state.up&&(t-=1),e.con.state.down&&(t+=1)),t},a.prototype.proper=function(e,t){var n=this;return arguments.length===1&&(t=e,e=n.id),n.match.spec[e]?n.match.spec[e][t]:undefined},a}),define("F.core/combodec",[],function(){function e(e,t,n){this.time=1,this.timeout=0,this.comboout=0,this.con=e,this.seq=new Array,this.config=t,this.combo=n,this.con.child.push(this)}return e.prototype.key=function(e,t){if(!t)return;var n=this.seq,r=!0;if(this.config.rp)for(var i=n.length-1,s=1;i>=0&&n[i]==e;i--,s++)s>=this.config.rp[e]&&(r=!1);this.con.state[e]&&(r=!1),this.config.timeout&&(this.timeout=this.time+this.config.timeout),this.config.comboout&&(this.comboout=this.time+this.config.comboout),r&&n.push({k:e,t:this.time});if(this.combo&&r){var o=this.combo;for(var i in o){var u=!0,a=n.length-o[i].seq.length;if(a<0)u=!1;else for(var f=0;a<n.length;a++,f++)if(o[i].seq[f]!==n[a].k||o[i].maxtime&&n[n.length-1].t-n[a].t>o[i].maxtime){u=!1;break}u&&(this.config.callback(o[i]),(o[i].clear_on_combo||o[i].clear_on_combo!==!1&&this.config.clear_on_combo)&&this.clear_seq())}}},e.prototype.clear_seq=function(){this.seq.length=0,this.timeout=this.time-1,this.comboout=this.time-1},e.prototype.frame=function(){this.time===this.timeout&&this.clear_seq(),this.time===this.comboout&&this.seq.push({k:"_",t:this.time}),this.time++},e}),define("LF/character",["LF/livingobject","LF/global","F.core/combodec","F.core/util","LF/util"],function(e,t,n,r,i){function f(r,i,o){var a=this;e.call(this,r,i,o),typeof u[a.id]=="function"?a.id_update=u[a.id]:a.id_update=u["default"],a.mech.floor_xbound=!0,a.con=r.controller,a.combo_buffer={combo:null,timeout:0};if(a.con){function f(e){var t=e.name;switch(t){case"left":case"right":a.allow_switch_dir&&a.switch_dir(t)}a.combo_buffer.combo=t,a.combo_buffer.timeout=10}var l={clear_on_combo:!0,callback:f},c=[{name:"left",seq:["left"],clear_on_combo:!1},{name:"right",seq:["right"],clear_on_combo:!1},{name:"up",seq:["up"],clear_on_combo:!1},{name:"down",seq:["down"],clear_on_combo:!1},{name:"def",seq:["def"],clear_on_combo:!1},{name:"jump",seq:["jump"],clear_on_combo:!1},{name:"att",seq:["att"],clear_on_combo:!1},{name:"run",seq:["right","right"],maxtime:9},{name:"run",seq:["left","left"],maxtime:9},{name:"jump-att",seq:["jump","att"],maxtime:0,clear_on_combo:!1}];a.combodec=new n(a.con,l,c.concat(t.combo_list))}a.hold={obj:null},a.health.bdefend=0,a.health.fall=0,a.health.hp=a.health.hp_full=a.health.hp_bound=a.proper("hp")||s.default.health.hp_full,a.health.mp_full=s.default.health.mp_full,a.health.mp=s.default.health.mp_start,a.trans.frame=function(e,t){if(e===0||e===999){this.set_next(e,t),this.set_wait(0,t);return}var n=a.data.frame[e];if(!n)return;var r=0;n.mp>0&&(r=n.mp%1e3),a.health.mp-r>=0&&(this.set_next(e,t),this.set_wait(0,t))},a.setup()}var s=t.gameplay,o={generic:function(e,n){var r=this;switch(e){case"frame":r.opoint();break;case"TU":r.state_update("post_interaction")||r.post_interaction();var o=r.ps;if(o.y===0&&o.vy>0){var u=r.state_update("fell_onto_ground");u?r.trans.frame(u,15):(o.vy=0,r.mech.linear_friction(i.lookup_abs(s.friction.fell,o.vx),i.lookup_abs(s.friction.fell,o.vz)))}else if(o.y+o.vy>=0&&o.vy>0){var u=r.state_update("fall_onto_ground");u?r.trans.frame(u,15):r.frame.N===212?r.trans.frame(215,15):r.trans.frame(219,15)}if(r.frame.D.mp)if(r.data.frame[r.frame.PN].next===r.frame.N)r.frame.D.mp<0&&(r.health.mp+=r.frame.D.mp,r.health.mp<0&&(r.health.mp=0,r.trans.frame(r.frame.D.hit_d)));else{var a=r.frame.D.mp%1e3,f=Math.floor(r.frame.D.mp/1e3)*10;r.health.mp-=a,r.health.hp-=f}r.match.time.t%12===0&&r.health.hp<r.health.hp_bound&&r.health.hp++,r.match.time.t%3===0&&r.health.mp<r.health.mp_full&&(r.health.mp+=1+Math.floor((500-(r.health.hp<500?r.health.hp:500))/100)),r.health.fall>0&&(r.health.fall+=s.recover.fall),r.health.bdefend>0&&(r.health.bdefend+=s.recover.bdefend),r.combo_buffer.timeout--;if(r.combo_buffer.timeout===0)switch(r.combo_buffer.combo){case"def":case"jump":case"jump-att":case"att":case"run":r.combo_buffer.combo=null}break;case"transit":r.mech.dynamics(),r.wpoint();break;case"combo":switch(n){case"left":case"right":case"run":break;default:var l=t.combo_tag[n];if(l&&r.frame.D[l]&&!r.id_update("generic_combo",n,l))return r.trans.frame(r.frame.D[l],11),1}break;case"post_combo":r.pre_interaction();break;case"state_exit":switch(r.combo_buffer.combo){case"att":case"run":r.combo_buffer.combo=null;break;case"jump-att":r.combo_buffer.combo="att"}}},0:function(e,t){var n=this;switch(e){case"frame":n.hold.obj&&n.hold.obj.type==="heavyweapon"&&n.trans.frame(12);break;case"combo":switch(t){case"left":case"right":case"up":case"down":case"jump":case null:var i=n.con.state.left!==n.con.state.right,s=n.con.state.up!==n.con.state.down;if(i||s)n.hold.obj&&n.hold.obj.type==="heavyweapon"?(i&&(n.ps.vx=n.dirh()*n.data.bmp.heavy_walking_speed),n.ps.vz=n.dirv()*n.data.bmp.heavy_walking_speedz):(t!=="jump"&&n.trans.frame(5),i&&(n.ps.vx=n.dirh()*n.data.bmp.walking_speed),n.ps.vz=n.dirv()*n.data.bmp.walking_speedz)}switch(t){case"run":return n.hold.obj&&n.hold.obj.type==="heavyweapon"?n.trans.frame(16,10):n.trans.frame(9,10),1;case"def":if(n.hold.obj&&n.hold.obj.type==="heavyweapon")return 1;return n.trans.frame(110,10),1;case"jump":case"jump-att":if(n.hold.obj&&n.hold.obj.type==="heavyweapon")return n.proper("heavy_weapon_jump")?(n.trans.frame(n.proper("heavy_weapon_jump"),10),1):1;return n.trans.frame(210,10),1;case"att":if(n.hold.obj){var i=n.con.state.left!==n.con.state.right;if(n.hold.obj.type==="heavyweapon")return n.trans.frame(50,10),1;if(n.proper(n.hold.obj.id,"just_throw"))return n.trans.frame(45,10),1;if(i&&n.proper(n.hold.obj.id,"stand_throw"))return n.trans.frame(45,10),1;if(n.proper(n.hold.obj.id,"attackable"))return n.trans.frame(n.match.random()<.5?20:25,10),1}var o=n.mech.volume(r.make_array(n.data.frame[72].itr)[0]),u=n.scene.query(o,n,{tag:"itr:6",not_team:n.team});for(var a in u)return n.trans.frame(70,10),1;return n.trans.frame(n.match.random()<.5?60:65,10),1}}},1:function(e,t){var n=this,r=0,i=0;n.con.state.left&&(r-=1),n.con.state.right&&(r+=1),n.con.state.up&&(i-=1),n.con.state.down&&(i+=1);switch(e){case"frame":n.hold.obj&&n.hold.obj.type==="heavyweapon"?r||i?n.frame_ani_oscillate(12,15):n.trans.set_next(n.frame.N):n.frame_ani_oscillate(5,8),n.trans.set_wait(n.data.bmp.walking_frame_rate-1);break;case"TU":var s=1-(n.dirv()?1:0)*(2/7);n.hold.obj&&n.hold.obj.type==="heavyweapon"?(r&&(n.ps.vx=s*n.dirh()*n.data.bmp.heavy_walking_speed),n.ps.vz=n.dirv()*n.data.bmp.heavy_walking_speedz):(r&&(n.ps.vx=s*n.dirh()*n.data.bmp.walking_speed),n.ps.vz=n.dirv()*n.data.bmp.walking_speedz,!r&&!i&&!n.statemem.transed&&(n.statemem.transed=!0,n.trans.set_next(999),n.trans.set_wait(1,1,2)));break;case"state_entry":n.trans.set_wait(0);break;case"combo":r!==0&&r!==n.dirh()&&n.switch_dir(n.ps.dir==="right"?"left":"right"),!r&&!i&&!n.statemem.released&&(n.statemem.released=!0,n.mech.unit_friction());if(t)return n.states[0].call(n,e,t)}},2:function(e,t){var n=this;switch(e){case"frame":n.hold.obj&&n.hold.obj.type==="heavyweapon"?n.frame_ani_oscillate(16,18):n.frame_ani_oscillate(9,11),n.trans.set_wait(n.data.bmp.running_frame_rate);case"TU":var r=1-(n.dirv()?1:0)*(1/7);n.hold.obj&&n.hold.obj.type==="heavyweapon"?(n.ps.vx=r*n.dirh()*n.data.bmp.heavy_running_speed,n.ps.vz=n.dirv()*n.data.bmp.heavy_running_speedz):(n.ps.vx=r*n.dirh()*n.data.bmp.running_speed,n.ps.vz=n.dirv()*n.data.bmp.running_speedz);break;case"combo":switch(t){case"left":case"right":if(t!=n.ps.dir)return n.hold.obj&&n.hold.obj.type==="heavyweapon"?n.trans.frame(19,10):n.trans.frame(218,10),1;break;case"def":if(n.hold.obj&&n.hold.obj.type==="heavyweapon")return 1;return n.trans.frame(102,10),1;case"jump":case"jump-att":if(n.hold.obj&&n.hold.obj.type==="heavyweapon")return n.proper("heavy_weapon_dash")?(n.trans.frame(n.proper("heavy_weapon_dash"),10),1):1;n.trans.frame(213,10);if(t==="jump-att")return 0;return 1;case"att":if(n.hold.obj){if(n.hold.obj.type==="heavyweapon")return n.trans.frame(50,10),1;var i=n.con.state.left!==n.con.state.right;if(i&&n.proper(n.hold.obj.id,"run_throw"))return n.trans.frame(45,10),1;if(n.proper(n.hold.obj.id,"attackable"))return n.trans.frame(35,10),1}return n.trans.frame(85,10),1}}},3:function(e,t){var n=this;switch(e){case"frame":n.frame.D.next===999&&n.ps.y<0&&n.trans.set_next(212),n.id_update("state3_frame");break;case"hit_stop":return n.id_update("state3_hit_stop");case"frame_force":return n.id_update("state3_frame_force")}},4:function(e,t){var n=this;switch(e){case"frame":n.statemem.frameTU=!0;if(n.frame.PN===80||n.frame.PN===81)n.statemem.attlock=2;break;case"TU":if(n.statemem.frameTU){n.statemem.frameTU=!1;if(n.frame.N===212&&n.frame.PN===211){var r=0;n.con.state.left&&(r-=1),n.con.state.right&&(r+=1),n.ps.vx=r*(n.data.bmp.jump_distance-1),n.ps.vz=n.dirv()*(n.data.bmp.jump_distancez-1),n.ps.vy=n.data.bmp.jump_height}}n.statemem.attlock&&n.statemem.attlock--;break;case"combo":if((t==="att"||n.con.state.att)&&!n.statemem.attlock&&n.frame.N===212){if(n.hold.obj){var r=n.con.state.left!==n.con.state.right;r&&n.proper(n.hold.obj.id,"jump_throw")?n.trans.frame(52,10):n.proper(n.hold.obj.id,"attackable")&&n.trans.frame(30,10)}else n.trans.frame(80,10);if(t==="att")return 1}}},5:function(e,t){var n=this;switch(e){case"state_entry":n.ps.vx=n.dirh()*(n.data.bmp.dash_distance-1)*(n.frame.N===213?1:-1),n.ps.vz=n.dirv()*(n.data.bmp.dash_distancez-1),n.ps.vy=n.data.bmp.dash_height;break;case"combo":if(t==="att"||n.con.state.att)if(n.proper("dash_backattack")||n.dirh()===(n.ps.vx>0?1:-1)){n.hold.obj&&n.proper(n.hold.obj.id,"attackable")?n.trans.frame(40,10):n.trans.frame(90,10),n.allow_switch_dir=!1;if(t==="att")return 1}if(t==="left"||t==="right")if(t!=n.ps.dir)return n.dirh()==(n.ps.vx>0?1:-1)?(n.frame.N===213&&n.trans.frame(214,0),n.frame.N===216&&n.trans.frame(217,0),n.switch_dir(t)):(n.frame.N===214&&n.trans.frame(213,0),n.frame.N===217&&n.trans.frame(216,0),n.switch_dir(t)),1}},6:function(e,t){var n=this;switch(e){case"TU":if(n.frame.N===100||n.frame.N===108)n.ps.vy=0;break;case"frame":(n.frame.N===100||n.frame.N===108)&&n.trans.set_wait(1);break;case"fall_onto_ground":if(n.frame.N===101||n.frame.N===109)return 215}},7:function(e,t){var n=this;switch(e){case"frame":n.frame.N===111&&n.trans.inc_wait(4)}},8:function(e,t){var n=this;switch(e){case"frame_force":case"TU_force":if(n.frame.D.dvx&&(n.ps.vx>0?1:-1)!==n.dirh()){var r=n.ps.vx>0?n.ps.vx:-n.ps.vx,i=2*(n.ps.vx>0?1:-1);if(n.ps.y<0||r<n.frame.D.dvx)n.ps.vx=i*n.frame.D.dvx;n.frame.D.dvx<0&&(n.ps.vx=n.ps.vx-i)}}},9:function(e,t){var n=this;switch(e){case"state_entry":n.statemem.stateTU=!0,n.statemem.counter=43,n.statemem.attacks=0;break;case"state_exit":n.catching=null,n.ps.zz=0;break;case"frame":switch(n.frame.N){case 123:n.statemem.attacks++,n.statemem.counter+=3,n.trans.inc_wait(1);break;case 233:case 234:n.trans.inc_wait(-1)}if(n.frame.N===234)return;n.catching.caught_b(n.mech.make_point(n.frame.D.cpoint),n.frame.D.cpoint,n.ps.dir);break;case"TU":if(n.caught_cpointkind()===1&&n.catching.caught_cpointkind()===2&&n.statemem.stateTU){n.statemem.stateTU=!1,n.frame.D.cpoint.injury&&(n.catching.hit(n.frame.D.cpoint,n,{x:n.ps.x,y:n.ps.y,z:n.ps.z},null),n.trans.inc_wait(1,10,99));var r=s.default.cpoint.cover;n.frame.D.cpoint.cover!==undefined&&(r=n.frame.D.cpoint.cover),r===0||r===10?n.ps.zz=1:n.ps.zz=-1,n.frame.D.cpoint.dircontrol===1&&(n.con.state.left&&n.switch_dir("left"),n.con.state.right&&n.switch_dir("right"))}break;case"post_combo":n.statemem.counter--,n.statemem.counter<=0&&(n.frame.N!==122||n.statemem.attacks!==4)&&(n.frame.N===121||n.frame.N===122)&&(n.catching.caught_release(),n.trans.frame(999,15));break;case"combo":switch(t){case"att":if(n.frame.N===121){var i=n.con.state.left!==n.con.state.right,o=n.con.state.up!==n.con.state.down;if((i||o)&&n.frame.D.cpoint.taction){var u=n.frame.D.cpoint.taction;u<0?(n.switch_dir(n.ps.dir==="right"?"left":"right"),n.trans.frame(-u,10)):n.trans.frame(u,10);var a=n.data.frame[n.trans.next()];n.catching.caught_throw(a.cpoint,n.dirv()),n.statemem.counter+=10}else n.frame.D.cpoint.aaction?n.trans.frame(n.frame.D.cpoint.aaction,10):n.trans.frame(122,10)}return 1;case"jump":case"jump-att":if(n.frame.N===121&&n.frame.D.cpoint.jaction)return n.trans.frame(n.frame.D.cpoint.jaction,10),1}}},10:function(e,t){var n=this;switch(e){case"state_exit":n.catching=null,n.caught_b_holdpoint=null,n.caught_b_cpoint=null,n.caught_b_adir=null,n.caught_throwz=null;break;case"frame":n.statemem.frameTU=!0,n.trans.set_wait(99,10,99);break;case"TU":n.frame.N===135&&(n.ps.vy=0);if(n.caught_cpointkind()===2&&n.catching&&n.catching.caught_cpointkind()===1){if(n.statemem.frameTU){n.statemem.frameTU=!1;var r=n.caught_b_holdpoint,i=n.caught_b_cpoint,o=n.caught_b_adir;i.vaction&&n.trans.frame(i.vaction,20);if(i.throwvz!==s.unspecified){var u=i.throwvx,a=i.throwvy,f=i.throwvz;u!==0&&(n.ps.vx=(o==="right"?1:-1)*u),a!==0&&(n.ps.vy=a),f!==0&&(n.ps.vz=f*n.caught_throwz),n.mech.set_pos(n.ps.x+n.ps.vx*2.5,n.ps.y+n.ps.vy*2,n.ps.z+n.ps.vz)}else i.dircontrol===undefined?(i.cover&&i.cover>=10?n.switch_dir(o):n.switch_dir(o==="left"?"right":"left"),n.mech.coincideXZ(r,n.mech.make_point(n.frame.D.cpoint))):n.mech.coincideXY(r,n.mech.make_point(n.frame.D.cpoint))}}else n.catching&&n.trans.frame(212,10)}},11:function(e,t){var n=this;switch(e){case"state_entry":n.trans.inc_wait(0,20);break;case"frame":switch(n.frame.N){case 221:case 223:case 225:n.trans.set_next(999);break;case 220:case 222:case 224:case 226:}}},12:function(e,t){var n=this;switch(e){case"frame":if(n.effect.dvy<=0)switch(n.frame.N){case 180:n.trans.set_next(181),n.trans.set_wait(i.lookup_abs(s.fall.wait180,n.effect.dvy));break;case 181:n.trans.set_next(182);var r=n.ps.vy>0?n.ps.vy:-n.ps.vy;0<=r&&r<=4?n.trans.set_wait(2):4<r&&r<7?n.trans.set_wait(3):7<=r&&n.trans.set_wait(4);break;case 182:n.trans.set_next(183);break;case 186:n.trans.set_next(187);break;case 187:n.trans.set_next(188);break;case 188:n.trans.set_next(189)}else switch(n.frame.N){case 180:n.trans.set_next(185),n.trans.set_wait(1);break;case 186:n.trans.set_next(191)}break;case"fell_onto_ground":case"fall_onto_ground":n.caught_throwinjury>0&&(n.injury(-n.caught_throwinjury),n.caught_throwinjury=null);var o=n.ps;if(n.mech.speed()>s.character.bounceup.limit.xy||o.vy>s.character.bounceup.limit.y){n.mech.linear_friction(i.lookup_abs(s.character.bounceup.absorb,o.vx),i.lookup_abs(s.character.bounceup.absorb,o.vz)),o.vy=-s.character.bounceup.y;if(180<=n.frame.N&&n.frame.N<=185)return 185;if(186<=n.frame.N&&n.frame.N<=191)return 191}else{if(180<=n.frame.N&&n.frame.N<=185)return 230;if(186<=n.frame.N&&n.frame.N<=191)return 231}break;case"combo":if(n.frame.N===182||n.frame.N===188)if(t==="jump")return n.frame.N===182?n.trans.frame(100):n.trans.frame(108),n.ps.vx&&(n.ps.vx=5*(n.ps.vx>0?1:-1)),n.ps.vz&&(n.ps.vz=2*(n.ps.vz>0?1:-1)),1;return 1}},14:function(e,t){var n=this;switch(e){case"state_entry":n.health.fall=0,n.health.bdefend=0;break;case"state_exit":n.effect.timein=0,n.effect.timeout=30,n.effect.blink=!0,n.effect.super=!0}},15:function(e,t){var n=this;switch(e){case"frame":switch(n.frame.N){case 19:n.hold.obj&&n.hold.obj.type==="heavyweapon"&&n.trans.set_next(12);break;case 215:n.trans.inc_wait(-1);break;case 219:if(!n.id_update("state15_crouch"))switch(n.frame.PN){case 105:n.mech.unit_friction();break;case 216:case 90:case 91:case 92:n.trans.inc_wait(-1)}break;case 54:n.frame.D.next===999&&n.ps.y<0&&n.trans.set_next(212)}break;case"combo":if(n.frame.N===215){if(t==="def")return n.trans.frame(102,10),1;if(t==="jump"){var r=0;return n.con.state.left&&(r-=1),n.con.state.right&&(r+=1),r?(n.trans.frame(213,10),n.switch_dir(r===1?"right":"left")):n.ps.vx===0?(n.trans.inc_wait(2,10,99),n.trans.set_next(210,10)):(n.ps.vx>0?1:-1)===n.dirh()?n.trans.frame(213,10):n.trans.frame(214,10),1}}}},16:function(e,t){var n=this;switch(e){}},301:function(e,t){var n=this;switch(e){case"frame_force":if(n.frame.N!==290)return 1;break;case"TU":n.ps.vz=n.dirv()*n.data.bmp.walking_speedz;break;case"hit_stop":return n.effect_stuck(1,2),n.trans.inc_wait(1),1}},x:function(e,t){var n=this;switch(e){}}},u={"default":function(){},1:function(e,t,n){var r=this;switch(e){case"state3_frame":switch(r.frame.N){case 267:return r.ps.vy+=1,1}break;case"state15_crouch":r.frame.PN>=267&&r.frame.PN<=272&&r.trans.inc_wait(-1);break;case"generic_combo":n==="hit_Fj"&&(t==="D>J"||t==="D>AJ"?r.switch_dir("right"):r.switch_dir("left"))}},11:function(e){var t=this;switch(e){case"state3_hit_stop":switch(t.frame.N){case 271:case 276:case 280:return t.effect_stuck(1,2),t.trans.inc_wait(1),1;case 273:return t.effect_stuck(0,2),1}break;case"state3_frame_force":switch(t.frame.N){case 275:case 278:case 279:return 1}}}},a={0:!0,1:!0,2:!1,3:!1,4:!0,5:!1,6:!1,7:!0,8:!1,9:!1,10:!1,11:!1,12:!1,13:!0,14:!1,15:!1,16:!1};return f.prototype=new e,f.prototype.constructor=f,f.prototype.type="character",f.prototype.states=o,f.prototype.states_switch_dir=a,f.prototype.destroy=function(){var t=this;e.prototype.destroy.call(this)},f.prototype.combo_update=function(){var e=this,t=e.combo_buffer.combo;t||(t=null);var n=e.states[e.frame.D.state];if(n)var r=n.call(e,"combo",t);var i=e.states.generic;if(!r&&i)var s=i.call(e,"combo",t);n&&n.call(e,"post_combo"),i&&i.call(e,"post_combo");if(r||s||t==="left"||t==="right"||t==="up"||t==="down")e.combo_buffer.combo=null},f.prototype.hit=function(e,t,n,r){function v(){e.fall!==undefined?o.health.fall+=e.fall:o.health.fall+=s.default.fall.value;var t=o.health.fall;o.ps.y<0||o.ps.vy<0?m():0<t&&t<=20?o.trans.frame(220,20):20<t&&t<=30?o.trans.frame(222,20):30<t&&t<=40?o.trans.frame(224,20):40<t&&t<=60?o.trans.frame(226,20):s.fall.KO<t&&m()}function m(){e.dvy===undefined&&(f=s.default.fall.dvy),o.health.fall=0,o.ps.vy=0;var t=n.x>o.ps.x==(o.ps.dir==="right");t&&e.dvx<0&&e.bdefend>=60?o.trans.frame(186,20):t?o.trans.frame(180,20):t||o.trans.frame(186,20),o.proper(o.effect_id(p),"drop_weapon")&&o.drop_weapon(a,f)}var o=this;if(o.itr.vrest[t.uid])return!1;var u=!1,a=0,f=0,l=0;if(o.state()===10){o.catching.caught_cpointhurtable()&&(u=!0,v());if(o.catching.caught_cpointhurtable()!==0||o.catching===t){u=!0,l-=Math.abs(e.injury);if(e.injury>0){o.effect_create(0,s.effect.duration);var c;e.vaction?c=e.vaction:c=n.x>o.ps.x==(o.ps.dir==="right")?o.frame.D.cpoint.fronthurtact:o.frame.D.cpoint.backhurtact,o.trans.frame(c,20)}}}else if(o.state()!==14){u=!0;var h=o.ps.y===0?1:0;a=e.dvx?t.dirh()*(e.dvx-h):0,f=e.dvy?e.dvy:0;var p=e.effect!==undefined?e.effect:s.default.effect.num;o.state()===7&&n.x>o.ps.x==(o.ps.dir==="right")?(e.injury&&(l-=s.defend.injury.factor*e.injury),e.bdefend&&(o.health.bdefend+=e.bdefend),o.health.bdefend>s.defend.break_limit?o.trans.frame(112,20):o.trans.frame(111,20),a&&(a+=(a>0?-1:1)*i.lookup_abs(s.defend.absorb,a)),f=0):(o.hold.obj&&o.hold.obj.type==="heavyweapon"&&o.drop_weapon(0,0),e.injury&&(l-=e.injury),o.health.bdefend=45,v());var d=s.effect.duration-1;switch(o.trans.next()){case 111:d=3;break;case 112:d=4}o.effect_create(p,d,a,f),o.visualeffect_create(p,r,n.x<o.ps.x,o.health.fall>0?1:2)}return l<0&&o.injury(l),u&&e&&e.vrest&&(o.itr.vrest[t.uid]=e.vrest),u},f.prototype.injury=function(e){this.health.hp+=e,this.health.hp_bound+=Math.ceil(e*1/3)},f.prototype.pre_interaction=function(){var e=this,t=r.make_array(e.trans.next_frame_D().itr);for(var n in t){var i=t[n],s=e.mech.volume(i);s.zwidth=0;var o=e.scene.query(s,e,{tag:"body"});switch(i.kind){case 1:case 3:for(var u in o)if(o[u].team!==e.team&&o[u].type==="character"&&(i.kind===1&&o[u].state()===16||i.kind===3)&&!e.itr.arest){var a=o[u].caught_a(i,e,{x:e.ps.x,y:e.ps.y,z:e.ps.z});if(a){e.itr_arest_update(i),a==="front"?e.trans.frame(i.catchingact[0],10):e.trans.frame(i.catchingact[1],10),e.catching=o[u];break}}break;case 7:if(!e.con.state.att)break;case 2:if(!e.hold.obj)for(var u in o)if(i.kind!==7||o[u].type!=="heavyweapon")if(o[u].type==="lightweapon"||o[u].type==="heavyweapon")if(o[u].pick(e)){e.itr_arest_update(i),i.kind===2&&(o[u].type==="lightweapon"?e.trans.frame(115,10):o[u].type==="heavyweapon"&&e.trans.frame(116,10)),e.hold.obj=o[u];break}}}},f.prototype.post_interaction=function(){var e=this,t=r.make_array(e.frame.D.itr);for(var n in t){var i=t[n],o=e.mech.volume(i);o.zwidth=0;var u=e.scene.query(o,e,{tag:"body"});switch(i.kind){case 0:for(var a in u)if(u[a].type!=="character"||u[a].team!==e.team)if(u[a].type==="character"||u[a].team!==e.team||u[a].ps.dir!==e.ps.dir)if(i.effect===undefined||i.effect===0||i.effect===1||i.effect===4&&u[a].type==="specialattack"&&u[a].state()===3e3)if(!e.itr.arest&&u[a].hit(i,e,{x:e.ps.x,y:e.ps.y,z:e.ps.z},o)){e.itr_arest_update(i);if(!e.state_update("hit_stop"))switch(e.frame.N){case 86:case 87:e.effect_stuck(0,2),e.trans.inc_wait(1);break;case 91:e.effect_stuck(0,2),e.trans.inc_wait(1);break;default:e.effect_stuck(0,s.default.itr.hit_stop)}if(i.arest)break}}}},f.prototype.wpoint=function(){var e=this;if(e.hold.obj&&e.frame.D.wpoint)if(e.frame.D.wpoint.kind===1){var t=e.hold.obj.act(e,e.frame.D.wpoint,e.mech.make_point(e.frame.D.wpoint));t.thrown&&(e.hold.obj=null),t.hit!==null&&t.hit!==undefined&&(e.itr_arest_update(t),e.trans.inc_wait(s.default.itr.hit_stop,10))}else e.frame.D.wpoint.kind===3&&e.drop_weapon()},f.prototype.opoint=function(){var e=this;e.frame.D.opoint&&e.match.create_object(e.frame.D.opoint,e)},f.prototype.drop_weapon=function(e,t){var n=this;n.hold.obj&&(n.hold.obj.drop(e,t),n.hold.obj=null)},f.prototype.vol_itr=function(e){var t=this;return t.frame.D.itr?t.mech.body(t.frame.D.itr,function(t){return t.kind==e}):[]},f.prototype.caught_a=function(e,t,n){var r=this;if(r.state()===16)return n.x>r.ps.x==(r.ps.dir==="right")?r.trans.frame(e.caughtact[0],20):r.trans.frame(e.caughtact[1],20),r.health.fall=0,r.catching=t,r.drop_weapon(),n.x>r.ps.x==(r.ps.dir==="right")?"front":"back"},f.prototype.caught_b=function(e,t,n){var r=this;r.caught_b_holdpoint=e,r.caught_b_cpoint=t,r.caught_b_adir=n},f.prototype.caught_cpointkind=function(){var e=this;return e.frame.D.cpoint?e.frame.D.cpoint.kind:0},f.prototype.caught_cpointhurtable=function(){var e=this;return e.frame.D.cpoint&&e.frame.D.cpoint.hurtable!==undefined?e.frame.D.cpoint.hurtable:s.default.cpoint.hurtable},f.prototype.caught_throw=function(e,t){var n=this;e.vaction!==undefined?n.trans.frame(e.vaction,20):n.trans.frame(s.default.cpoint.vaction,20),n.caught_throwinjury=e.throwinjury,n.caught_throwinjury===s.unspecified&&(n.caught_throwinjury=s.default.itr.throw_injury),n.caught_throwz=t},f.prototype.caught_release=function(){var e=this;e.catching=0,e.trans.frame(181,20),e.effect.dvx=3,e.effect.dvy=-3,e.effect.timein=-1,e.effect.timeout=0},f}),define("LF/weapon",["LF/livingobject","LF/global","F.core/util"],function(e,t,n){function i(t){function s(t,n,r){var i=this;e.call(this,t,n,r);for(var s=0;s<i.sp.ani.length;s++)i.sp.ani[s].config.borderleft=1,i.sp.ani[s].config.bordertop=0,i.sp.ani[s].config.borderright=2,i.sp.ani[s].config.borderbottom=2;i.hold={obj:null},i.setup()}var i={generic:function(e,t){var n=this;switch(e){case"TU":n.interaction();switch(n.state()){case 1001:case 2001:break;default:n.mech.dynamics()}var i=n.ps;i.y===0&&i.vy>0&&(this.mech.speed()>r.weapon.bounceup.limit?(n.light&&(i.vy=0,n.trans.frame(70)),n.heavy&&(i.vy=r.weapon.bounceup.speed.y),i.vx&&(i.vx=(i.vx>0?1:-1)*r.weapon.bounceup.speed.x),i.vz&&(i.vz=(i.vz>0?1:-1)*r.weapon.bounceup.speed.z)):(n.team=0,i.vy=0,n.light&&n.trans.frame(70),n.heavy&&n.trans.frame(21),n.health.hp-=n.data.bmp.weapon_drop_hurt),i.zz=0)}},1004:function(e,t){var n=this;switch(e){case"frame":n.frame.N===64&&(n.team=0)}},2e3:function(e,t){var n=this;switch(e){case"frame":n.frame.N===21&&n.trans.set_next(20)}},2004:function(e,t){var n=this;switch(e){case"frame":n.frame.N===20&&(n.team=0)}}};return s.prototype=new e,s.prototype.constructor=s,s.prototype.light=t==="lightweapon",s.prototype.heavy=t==="heavyweapon",s.prototype.type=t,s.prototype.states=i,s.prototype.interaction=function(){var e=this,t=n.make_array(e.frame.D.itr);if(e.team!==0)if(e.heavy||e.light&&e.state()===1002)for(var i in t)if(t[i].kind===0){var s=e.mech.volume(t[i]);s.zwidth=0;var o=e.scene.query(s,e,{tag:"body",not_team:e.team});for(var u in o){var a;t[i].arest!==undefined||t[i].vrest!==undefined?a=t[i]:a=r.default.weapon;if(!e.itr.arest&&o[u].hit(t[i],e,{x:e.ps.x,y:e.ps.y,z:e.ps.z},s)){var f=e.ps,l=f.vx===0?0:f.vx>0?1:-1;e.light&&(f.vx=l*r.weapon.hit.vx,f.vy=r.weapon.hit.vy),e.itr_arest_update(t);var c;e.light&&(c=2),e.heavy&&(c=4),e.effect.dvx=0,e.effect.dvy=0,e.effect_stuck(0,c)}}}},s.prototype.hit=function(e,t,n,i){var s=this;if(s.hold.obj)return!1;if(s.itr.vrest[t.uid])return!1;var o=!1;s.light&&(s.state()===1002?(o=!0,t.dirh()>0!=s.ps.vx>0&&(s.ps.vx*=r.weapon.reverse.factor.vx),s.ps.vy*=r.weapon.reverse.factor.vy,s.ps.vz*=r.weapon.reverse.factor.vz,s.team=t.team):s.state()===1004&&(t.type==="lightweapon"||t.type==="heavyweapon")&&(o=!0,s.ps.vx=(t.ps.vx?t.ps.vx>0?1:-1:0)*r.weapon.bounceup.speed.x,s.ps.vz=(t.ps.vz?t.ps.vz>0?1:-1:0)*r.weapon.bounceup.speed.z));var u=e.fall!==undefined?e.fall:r.default.fall.value;return s.heavy&&(s.state()===2004?(o=!0,u<30?s.effect_create(0,r.effect.duration):u<r.fall.KO?s.ps.vy=r.weapon.soft_bounceup.speed.y:(s.ps.vy=r.weapon.bounceup.speed.y,t.ps.vx&&(s.ps.vx=(t.ps.vx>0?1:-1)*r.weapon.bounceup.speed.x),t.ps.vz&&(s.ps.vz=(t.ps.vz>0?1:-1)*r.weapon.bounceup.speed.z),s.trans.frame(999))):s.state()===2e3&&u>=r.fall.KO&&(o=!0,t.dirh()>0!=s.ps.vx>0&&(s.ps.vx*=r.weapon.reverse.factor.vx),s.ps.vy*=r.weapon.reverse.factor.vy,s.ps.vz*=r.weapon.reverse.factor.vz,s.team=t.team)),o&&(s.visualeffect_create(0,i,n.x<s.ps.x,u<r.fall.KO?1:2),e&&e.vrest&&(s.itr.vrest[t.uid]=e.vrest)),o},s.prototype.act=function(e,t,i){var s=this,o=s.frame.D,u={};s.data.frame[t.weaponact]&&(s.trans.frame(t.weaponact),s.trans.trans());if(o.wpoint&&o.wpoint.kind===2){t.dvx&&(s.ps.vx=e.dirh()*t.dvx),t.dvz&&(s.ps.vz=e.dirv()*t.dvz),t.dvy&&(s.ps.vy=t.dvy);if(s.ps.vx||s.ps.vy||s.ps.vz){var a,f;s.light&&(a=58,f=-15),s.heavy&&(a=48,f=-40),s.mech.set_pos(e.ps.x+e.dirh()*a,e.ps.y+f,e.ps.z+s.ps.vz),s.ps.zz=1,s.light&&s.trans.frame(40),s.heavy&&s.trans.frame(999),s.trans.trans(),s.hold.obj=null,u.thrown=!0}if(!u.thrown){var l=t.cover!==undefined?t.cover:r.default.wpoint.cover;l===1?s.ps.zz=-1:s.ps.zz=0,s.switch_dir(e.ps.dir),s.ps.sz=s.ps.z=e.ps.z,s.mech.coincideXY(i,s.mech.make_point(o.wpoint)),s.mech.project()}if(s.light&&t.attacking){var c=n.make_array(o.itr);for(var h in c)if(c[h].kind===5){var p=s.mech.volume(c[h]);p.zwidth=0;var d=s.scene.query(p,[s,e],{tag:"body",not_team:s.team});for(var v in d)if(!e.itr.arest){var m;s.data.weapon_strength_list&&s.data.weapon_strength_list[t.attacking]?m=s.data.weapon_strength_list[t.attacking]:m=c[h],d[v].hit(m,e,{x:e.ps.x,y:e.ps.y,z:e.ps.z},p)&&(m.vrest&&(u.vrest=m.vrest),m.arest&&(u.arest=m.arest),u.hit=d[v].uid)}}}}return u.thrown&&s.shadow.show(),u},s.prototype.drop=function(e,t){var n=this;n.team=0,n.hold.obj=null,e&&(n.ps.vx=e*.5),t&&(n.ps.vy=t*.2),n.ps.zz=0,n.trans.frame(999),n.shadow.show()},s.prototype.pick=function(e){var t=this;return t.hold.obj?!1:(t.hold.obj=e,t.team=e.team,t.shadow.hide(),!0)},s.prototype.itr_rest_update=function(e,t,n){var i=this,s;n.arest?s=n.arest:n.vrest?s=n.vrest:s=r.default.weapon.vrest;if(e.type==="heavyweapon"||e.type==="lightweapon")s*=2;i.itr.vrest[t]=s},s.prototype.vol_itr=function(e){function t(t){return t.kind==e}var n=this;return n.frame.D.itr?n.mech.body(n.frame.D.itr,t):n.mech.body_empty()},s}var r=t.gameplay;return i}),define("LF/specialattack",["LF/livingobject","LF/global","F.core/util"],function(e,t,n){function s(t,n,i){var s=this;e.call(s,t,n,i),s.team=t.team,s.match=t.match,s.health.hp=s.proper("hp")||r.default.health.hp_full,s.mech.mass=0,s.setup()}var r=t.gameplay,i={generic:function(e,t){var n=this;switch(e){case"TU":n.interaction(),n.mech.dynamics(),n.frame.D.hit_a&&(n.health.hp-=n.frame.D.hit_a,n.health.hp<=0&&n.trans.frame(n.frame.D.hit_d));break;case"frame":n.frame.D.opoint&&n.match.create_object(n.frame.D.opoint,n);break;case"frame_force":case"TU_force":if(n.frame.D.hit_j){var r=n.frame.D.hit_j-50;n.ps.vz=r}}},3e3:function(e,t,n,r,i){var s=this;switch(e){case"hit_others":s.trans.frame(10);break;case"hit":if(n.type==="specialattack")return s.ps.vx=0,s.trans.frame(20),!0;if(n.type==="character")return s.ps.vx=0,s.team=n.team,s.trans.frame(30),s.trans.trans(),s.TU_update(),s.trans.trans(),s.TU_update(),!0}},3001:function(e,t){var n=this;switch(e){}},x:function(e,t){var n=this;switch(e){}}};return s.prototype=new e,s.prototype.constructor=s,s.prototype.states=i,s.prototype.type="specialattack",s.prototype.init=function(e,t,n,r){var i=this;i.mech.set_pos(0,0,t),i.mech.coincideXY(e,i.mech.make_point(i.frame.D,"center"));var s,o=r.facing;o>=20&&(o%=10),o===0?s=n:o===1?s=n==="right"?"left":"right":2<=o&&o<=10?s="right":11<=o&&o<=19&&(s="left"),i.switch_dir(s),i.trans.frame(r.action===0?999:r.action),i.trans.trans(),i.ps.vx=i.dirh()*r.dvx,i.ps.vy=r.dvy},s.prototype.interaction=function(){var e=this,t=n.make_array(e.frame.D.itr);if(e.team!==0)for(var r in t)if(t[r].kind===0){var i=e.mech.volume(t[r]);i.zwidth=0;var s=e.scene.query(i,e,{tag:"body"});for(var o in s)if(s[o].type!=="character"||s[o].team!==e.team)if(s[o].type==="character"||s[o].team!==e.team||s[o].ps.dir!==e.ps.dir)if(!e.itr.arest&&s[o].hit(t[r],e,{x:e.ps.x,y:e.ps.y,z:e.ps.z},i)){e.itr_arest_update(t),e.state_update("hit_others"),e.ps.vx=0;if(t[r].arest)break}}},s.prototype.hit=function(e,t,n,r){var i=this;return i.itr.vrest[t.uid]?!1:(e&&e.vrest&&(i.itr.vrest[t.uid]=e.vrest),i.state_update("hit",e,t,n,r))},s}),define("F.core/effects-pool",[],function(){function e(e){this.pool=[],this.S=0,this.E=0,this.full=!1,this.config=e,this.livecount=0,e.new_arg?e.new_arg instanceof Array?this.new_arg=e.new_arg:this.new_arg=[e.new_arg]:this.new_arg=[];for(var t=0;t<e.init_size;t++)this.pool[t]=e.construct(),this.pool[t].parent=this}return e.prototype.create=function(){if(this.full){if(!(this.pool.length+this.config.batch_size<=this.config.max_size))return!1;var e=[this.E,0];for(var t=0;t<this.config.batch_size;t++)e[t+2]=this.config.construct(),e[t+2].parent=this;this.pool.splice.apply(this.pool,e),this.S!==0&&(this.S+=this.config.batch_size),this.full=!1}this.E<this.pool.length?this.E++:this.E=1;if(this.E===this.S||this.S===0&&this.E===this.pool.length)this.full=!0;return this.pool[this.E-1].born&&this.pool[this.E-1].born.apply(this.pool[this.E-1],arguments),this.livecount++,this.pool[this.E-1]},e.prototype.die=function(){if(this.livecount>0){var e=this.S;return this.pool[this.S].die&&this.pool[this.S].die.apply(this.pool[this.S],arguments),this.S<this.pool.length-1?this.S++:this.S=0,this.full=!1,this.livecount--,this.pool[e]}console.log("die too much!")},e.prototype.for_each=function(e){if(this.livecount!==0)if(this.S<this.E){for(var t=this.S;t<this.E;t++)if(e(this.pool[t])==="break")break}else{for(var n=this.S;n<this.pool.length;n++)if(e(this.pool[n])==="break")return;for(var t=0;t<this.E;t++)if(e(this.pool[t])==="break")return}},e.prototype.call_each=function(e){if(this.pool[0][e]){var t=Array.prototype.slice.call(arguments,1);this.for_each(function(n){n[e].apply(n,t)})}},e}),define("LF/effects",["LF/global","LF/sprite","F.core/effects-pool"],function(e,t,n){function r(e,t,r){this.efs={};for(var s=0;s<t.length;s++)var o={init_size:5,batch_size:5,max_size:30,construct:function(){return new i(e,t[s],r[s])}},u=this.efs[r[s]]=new n(o)}function i(e,n,r){this.dat=n,this.type=n.effect_list,this.id=r,this.sp=new t(this.dat.bmp,e.stage),this.sp.hide(),this.frame,this.frameD,this.wait=-1,this.next}return r.prototype.destroy=function(){for(var e in this.efs)this.efs[e].destroy()},r.prototype.create=function(e,t,n){n||(n=0),this.efs[t]&&this.efs[t].create(e,n)},r.prototype.TU=function(){for(var e in this.efs)this.efs[e].TU()},r.prototype.transit=function(){},n.prototype.TU=function(){this.for_each(function(e){e.TU()})},n.prototype.destroy=function(){for(var e=0;e<this.pool.length;e++)this.pool[e].destroy()},i.prototype.destroy=function(){this.sp.destroy()},i.prototype.TU=function(){this.sp.show_pic(this.frameD.pic),this.wait=this.frameD.wait,this.next=this.frameD.next;if(this.wait===0){if(this.next===999)this.next=0;else if(this.next===1e3){this.sp.hide(),this.parent.die();return}this.frame=this.next,this.frameD=this.dat.frame[this.frame]}else this.wait--},i.prototype.transit=function(){},i.prototype.set_pos=function(e,t,n){},i.prototype.born=function(e,t){var n;this.type[t]&&this.type[t].frame?n=this.type[t].frame:n=0,this.frame=n,this.frameD=this.dat.frame[this.frame];var r=e.x-this.frameD.centerx,i=e.y-this.frameD.centery,s=e.z;this.sp.set_x_y(r,i+s),this.sp.set_z(s+1),this.sp.show_pic(this.frameD.pic),this.sp.show()},r}),define("LF/factories",["LF/character","LF/weapon","LF/specialattack","LF/effects"],function(e,t,n,r){return{character:e,lightweapon:t("lightweapon"),heavyweapon:t("heavyweapon"),specialattack:n,effects:r}}),define("F.core/collision",["F.core/math"],function(e){return{rect:function(e,t){return e.bottom<t.top?!1:e.top>t.bottom?!1:e.right<t.left?!1:e.left>t.right?!1:!0},rect_flat:function(e,t,n,r,i,s,o,u){return r<s?!1:t>u?!1:n<i?!1:e>o?!1:!0},normalize_rect:function(e){return e.left>e.right&&e.top>e.bottom?{left:e.right,right:e.left,top:e.bottom,bottom:e.top}:e.left>e.right?{left:e.right,right:e.left,top:e.top,bottom:e.bottom}:e.top>e.bottom?{left:e.left,right:e.right,top:e.bottom,bottom:e.top}:e},tri:function(t,n){function o(){var e=s;return s+=4,i[e]!=i[e+1]&&i[e+2]!=i[e+3]}var r=e.signed_area,i=[],s=0;i.push(r(t[0],t[1],n[0])>0,r(t[0],t[1],n[1])>0,r(t[0],n[0],n[1])>0,r(t[1],n[0],n[1])>0);if(o())return!0;i.push(i[1],r(t[0],t[1],n[2])>0,r(t[0],n[1],n[2])>0,r(t[1],n[1],n[2])>0);if(o())return!0;i.push(i[0],i[5],r(t[0],n[0],n[2])>0,r(t[1],n[0],n[2])>0);if(o())return!0;i.push(r(t[1],t[2],n[0])>0,r(t[1],t[2],n[1])>0,i[3],r(t[2],n[0],n[1])>0);if(o())return!0;i.push(i[13],r(t[1],t[2],n[2])>0,i[7],r(t[2],n[1],n[2])>0);if(o())return!0;i.push(i[12],i[17],i[11],r(t[2],n[0],n[2])>0);if(o())return!0;i.push(r(t[0],t[2],n[0])>0,r(t[0],t[2],n[1])>0,i[2],i[15]);if(o())return!0;i.push(i[25],r(t[0],t[2],n[2])>0,i[6],i[19]);if(o())return!0;i.push(i[24],i[29],i[10],i[23]);if(o())return!0;var u=[i[2]==i[6]&&i[6]==!i[10],i[3]==i[7]&&i[7]==!i[11],i[15]==i[19]&&i[19]==!i[23]],a=[i[0]==i[12]&&i[12]==!i[24],i[1]==i[13]&&i[13]==!i[25],i[9]==i[21]&&i[21]==!i[33]];return u[0]&&u[1]&&u[2]?!0:a[0]&&a[1]&&a[2]?!0:!1},circle:function(t,n){return e.distance(t.center,n.center)<=t.radius+n.radius},line:function(t,n,r,i){var s=e.signed_area(t,n,r)>0!=e.signed_area(t,n,i)>0&&e.signed_area(r,i,t)>0!=e.signed_area(r,i,n)>0;return s},point_in_rect:function(t,n){return e.inbetween(t.x,n.left,n.right)&&e.inbetween(t.y,n.top,n.bottom)}}}),define("LF/scene",["F.core/util","F.core/collision"],function(e,t){function n(e){this.live={},this.uid=0}return n.prototype.add=function(e){return this.uid++,e.uid=this.uid,this.live[e.uid]=e,e.uid},n.prototype.remove=function(e){var t=e.uid;return delete this.live[e.uid],e.uid=-1,t},n.prototype.query=function(e,t,n){var r=[],i=n.tag;i||(i="body");var s=0,o=i.split(":");i=o[0],s=o[1];for(var u in this.live){var a=!1;if(t instanceof Array){for(var f=0;f<t.length;f++)if(this.live[u]===t[f]){a=!0;break}}else t&&this.live[u]===t&&(a=!0);if(a)continue;if(n.not_team&&this.live[u].team===n.not_team)continue;if(n.type&&this.live[u].type!==n.type)continue;if(n.filter&&!n.filter(this.live[u]))continue;if(this.live[u]["vol_"+i]){var l=this.live[u]["vol_"+i](s);for(var c=0;c<l.length;c++)if(this.intersect(e,l[c])){r.push(this.live[u]);break}}}return r},n.prototype.intersect=function(e,n){var r=e.x+e.vx,i=e.y+e.vy,s=e.x+e.vx+e.w,o=e.y+e.vy+e.h,u=n.x+n.vx,a=n.y+n.vy,f=n.x+n.vx+n.w,l=n.y+n.vy+n.h;return t.rect_flat(r,i,s,o,u,a,f,l)&&t.rect_flat(e.z-e.zwidth,0,e.z+e.zwidth,1,n.z-n.zwidth,0,n.z+n.zwidth,1)},n.prototype.intersect_old=function(e,n){var r={left:e.x+e.vx,top:e.y+e.vy,right:e.x+e.vx+e.w,bottom:e.y+e.vy+e.h},i={left:n.x+n.vx,top:n.y+n.vy,right:n.x+n.vx+n.w,bottom:n.y+n.vy+n.h};return t.rect(r,i)&&t.rect({left:e.z-e.zwidth,top:0,right:e.z+e.zwidth,bottom:1},{left:n.z-n.zwidth,top:0,right:n.z+n.zwidth,bottom:1})},n.prototype.distance=function(e,t){var n=e.x+e.centerx-(t.x+t.centerx),r=e.y-t.y,i=e.z+e.centery-(t.z+t.centery);return Math.sqrt(n*n+r*r+i*i)},n}),define("LF/background",["F.core/util","F.core/sprite","F.core/support","LF/global"],function(e,t,n,r){function u(e){o.push(e),s||(s=setInterval(function(){for(var e=0;e<o.length;e++)o[e].TU()},1e3/30))}function a(r,s,o){function E(e){return s.name==="HK Coliseum"?e.pic.indexOf("back1")===-1?e.y-8:e.y:e.y}var a=this;if(!r){a.id=-1,a.name="empty background",a.width=1500,a.zboundary=[0,300],a.height=a.zboundary[1]-a.zboundary[0],a.shadow={x:0,y:0,img:""};return}a.layers=[],a.timed_layers=[],a.timer=0,a.floor=r.floor,a.data=s,a.name=s.name.replace(/_/g," "),a.id=o,a.zboundary=s.zboundary,a.width=s.width,a.height=a.zboundary[1]-a.zboundary[0],a.shadow={x:0,y:0,img:s.shadow},n.css3dtransform?a.dropframe=0:a.dropframe=1,function(){function n(){a.shadow.x=(this.naturalWidth||this.width)/2,a.shadow.y=(this.naturalHeight||this.height)/2,e.img[0].removeEventListener("load",n,!0)}var e=new t({img:s.shadow});e.img[0].addEventListener("load",n,!0)}(),a.floor&&(a.floor.style.width=a.width+"px");if(r.scrollbar){var l=document.createElement("div");a.scrollbar=l,l.className="backgroundScroll";var c=document.createElement("div");c.style.width=a.width+"px",c.className="backgroundScrollChild",l.appendChild(c),r.layers.parentNode.appendChild(l),l.onscroll=function(){a.camera_locked&&(a.camerax=l.scrollLeft,a.scroll(l.scrollLeft))},l.onmousedown=function(){a.camera_locked=!0},l.onmouseup=function(){a.camera_locked=!1},"__proto__"in{}||(l.onmousemove=function(){a.camera_locked=!1})}r.camerachase?(a.char=r.camerachase.character,a.camerax=a.width/2,a.cami=0):a.camera_locked=!0,a.floor&&a.layers.push({sp:new t({div:a.floor,type:"group"}),ratio:1});var h=e.group_elements(s.layer,"width");for(var p in h){var d={sp:new t({canvas:r.layers,type:"group"}),ratio:(parseInt(p)-i.window.width)/(a.width-i.window.width)};d.sp.set_z(-1e3+parseInt(p)),a.layers.push(d);for(var v=0;v<h[p].length;v++){var m=h[p][v],g;m.rect?g={canvas:d.sp.el,wh:{x:m.width,y:m.height}}:m.pic&&(g={canvas:d.sp.el,wh:"fit",img:m.pic});var y;if(!m.loop)y=new t(g),y.set_x_y(m.x,E(m)),m.rect&&(y.el.style.background=f(m.rect));else{y=new t({canvas:d.sp.el,type:"group"}),g.canvas=y.el,y.set_x_y(0,0);for(var b=m.x;b<m.width;b+=m.loop){var w=new t(g);w.set_x_y(b,m.y),m.rect&&(w.el.style.background=f(m.rect))}}m.cc&&a.timed_layers.push({sp:y,cc:m.cc,c1:m.c1,c2:m.c2})}}r.standalone&&(u(this),a.carousel={type:r.standalone.carousel,dir:1,speed:1},a.camera_locked=!1)}function f(e){if(typeof e=="string")return e;if(typeof e=="number"){var t,n;switch(e){case 4706:t="rgb(16,79,16)";break;case 40179:t="rgb(159,163,159)";break;case 29582:t="rgb(119,119,119)";break;case 37773:t="rgb(151,119,111)";break;case 33580:t="rgb(135,107,103)";break;case 25356:t="rgb(103,103,103)";break;case 21096:t="rgb(90,78,75)";break;case 37770:t="rgb(154,110,90)";break;case 16835:t="rgb(66,56,24)";break;case 34816:t="rgb(143,7,7)"}var r=e>>11<<3,i=(e>>6&31)<<3,s=(e&31)<<3;return n="rgb("+(r+(r>64||r===0?7:0))+","+(i+(i>64||i===0?7:0)+(e>>5&1&&i>80?4:0))+","+(s+(s>64||s===0?7:0))+")",t&&n!==t&&console.log("computed:"+n,"correct:"+t),t?t:n}}var i=r.application,s,o=[];a.prototype.destroy=function(){var e=this;if(e.name==="empty background")return;if(e.layers)for(var t=1;t<e.layers.length;t++)e.layers[t].sp.remove();if(e.timed_layers)for(var t=0;t<e.timed_layers.length;t++)e.timed_layers[t].sp.remove();e.scrollbar&&e.scrollbar.parentNode.removeChild(e.scrollbar)},a.prototype.leaving=function(e){var t=this,n=e.x+e.vx,r=e.y+e.vy;return n<0||n>t.width||r<-600||r>100},a.prototype.get_pos=function(e,t){var n=this;return{x:n.width*e,y:0,z:n.zboundary[0]+n.height*t}},a.prototype.scroll=function(e){var t=this;for(var n=0;n<t.layers.length;n++)t.layers[n].sp.set_x_y(-(e*t.layers[n].ratio),0)};var l=i.window.width,c=i.window.width/2;return a.prototype.TU=function(){var e=this;if(!e.camera_locked)if(!e.carousel){if(e.cami++%(e.dropframe+1)!==0)return;var t=0,n=0,r=0;for(var s in e.char)t+=e.char[s].ps.x,n+=e.char[s].dirh(),r++;r>0&&(t/=r);var o=n*l/24+(t-c);o<0&&(o=0),o>e.width-l&&(o=e.width-l);var u=(o-e.camerax)*i.camera.speed_factor*(e.dropframe+1);u!==0&&(-0.05<u&&u<.05?e.camerax=o:e.camerax=e.camerax+u,e.scroll(e.camerax),e.scrollbar&&(e.scrollbar.scrollLeft=Math.round(e.camerax)))}else if(e.carousel.type==="linear"){var a=e.scrollbar.scrollLeft;e.scrollbar.scrollLeft+=e.width/200*e.carousel.speed*e.carousel.dir,a===e.scrollbar.scrollLeft&&(e.carousel.dir*=-1),e.scroll(e.scrollbar.scrollLeft)}for(var s=0;s<e.timed_layers.length;s++){var f=e.timed_layers[s],h=e.timer%f.cc;h>=f.c1&&h<=f.c2?f.sp.show():f.sp.hide()}e.timer++},a}),define("LF/third_party/random",[],function(){function e(){this.next=function(){return this.x==0&&this.x==-1,this.y==0&&this.y==-1,this.x=this.nextX(),this.y=this.nextY(),((this.x<<16)+(this.y&65535))/4294967295+.5},this.nextX=function(){return 36969*(this.x&65535)+(this.x>>16)},this.nextY=function(){return 18273*(this.y&65535)+(this.y>>16)},this.nextInt=function(t,n){return n||(t=0,n=4294967295),Math.floor(this.next()*(n-t))+t},this.seed=function(e){this.x=e*3253,this.y=this.nextX()},this.seed2d=function(t,n){this.x=t*2549+n*3571,this.y=n*2549+t*3571},this.seed3d=function(t,n,r){this.x=t*2549+n*3571+r*3253,this.y=t*3253+n*2549+r*3571},this.seed_bytime=function(){var e=(new Date).getTime();return this.seed(e),e}}return e}),define("LF/match",["F.core/util","F.core/controller","F.core/sprite","LF/network","LF/factories","LF/scene","LF/background","LF/AI","LF/third_party/random","LF/util","LF/global"],function(e,t,n,r,i,s,o,u,a,f,l){function h(t){var n=this;n.manager=t.manager,n.stage=t.stage,n.state=t.state,n.data=t.package.data,n.spec=n.data.properties.data,n.grouped_object=e.group_elements(n.data.object,"type"),n.config=t.config,n.config||(n.config={}),n.time}var c=l.application;return h.prototype.create=function(t){var n=this,r=[];for(var i=0;i<t.player.length;i++)r.push(n.data.object[t.player[i].datanum].id),r=r.concat(e.extract_array(n.data.object[t.player[i].datanum].pack,"id").id);t.set||(t.set={}),n.randomseed=n.new_randomseed(),n.create_scenegraph(),n.create_effects(n.config.effects),n.control=n.create_controller(t.control),n.create_background(t.background),n.panel=[];for(var i=0;i<8;i++)n.panel[i]={};n.pause_mess=t.pause_mess,n.pause_mess&&n.pause_mess.hide(),n.tasks=[],n.AIscript=[],this.data.object.load(r,function(){t.player&&n.create_characters(t.player),t.set.weapon&&n.drop_weapons(t.set.weapon),n.create_timer()})},h.prototype.destroy=function(){var e=this;e.time.paused=!0,r.clearInterval(e.time.timer),e.for_all("destroy"),e.background.destroy();for(var t=0;t<e.panel.length;t++)e.panel[t].hp&&(e.panel[t].hp.remove(),e.panel[t].hp_bound.remove(),e.panel[t].mp.remove(),e.panel[t].mp_bound.remove(),e.panel[t].spic.remove());var n=["background","floor"];for(var t in n){var i=f.div(n[t]);if(i)while(i.lastChild)i.removeChild(i.lastChild)}},h.prototype.log=function(e){console.log(this.time.t+": "+e)},h.prototype.create_object=function(e,t){var n=this;n.tasks.push({task:"create_object",opoint:e,team:t.team,pos:t.mech.make_point(e),z:t.ps.z,dir:t.ps.dir})},h.prototype.destroy_object=function(e){var t=this;t.tasks.push({task:"destroy_object",obj:e})},h.prototype.create_scenegraph=function(){var e=this;e.scene=new s;for(var t in i)e[t]={}},h.prototype.create_timer=function(){var e=this;e.time={t:0,paused:!1,timer:null,$fps:f.div("fps")},e.time.$fps||(e.calculate_fps=function(){}),e.time.timer=r.setInterval(function(){e.frame()},1e3/30)},h.prototype.frame=function(){var e=this;e.control&&e.control.fetch();for(var t in e.character)e.character[t].con.fetch();e.time.paused?e.time.$fps&&(e.time.$fps.value="paused"):(e.TU_trans(),e.calculate_fps()),e.time.t===0&&e.match_event("start"),e.time.t++},h.prototype.TU_trans=function(){var e=this;e.emit_event("transit"),e.process_tasks(),e.emit_event("TU"),e.background.TU(),e.panel&&e.show_hp();if(e.time.t%3===0)for(var t=0;t<e.AIscript.length;t++)e.AIscript[t].TU()},h.prototype.match_event=function(e){var t=this;t.state&&t.state.event&&t.state.event.call(this,e)},h.prototype.emit_event=function(e){var t=this;t.state&&t.state.event&&t.state.event.call(this,e),t.for_all(e)},h.prototype.for_all=function(e){var t=this;for(var n in i)for(var r in t[n])t[n][r][e]()},h.prototype.process_tasks=function(){var e=this;for(var t=0;t<e.tasks.length;t++)e.process_task(e.tasks[t]);e.tasks.length=0},h.prototype.process_task=function(e){var t=this;switch(e.task){case"create_object":if(e.opoint.kind===1&&e.opoint.oid){var n=f.select_from(t.data.object,{id:e.opoint.oid}),r={match:t,team:e.team},s=new i[n.type](r,n.data,e.opoint.oid);s.init(e.pos,e.z,e.dir,e.opoint);var o=t.scene.add(s);t[s.type][o]=s}break;case"destroy_object":var s=e.obj;s.destroy();var o=t.scene.remove(s);delete t[s.type][o]}},h.prototype.calculate_fps=function(){var e=this,t=10;if(e.time.t%t===0){var n=e.time.time;e.time.time=(new Date).getTime();var r=e.time.time-n;e.time.$fps.value=Math.round(1e3/r*t)+"fps"}},h.prototype.create_characters=function(e){function d(e){for(var t=0;t<e.pack.length;t++){var r=e.pack[t].data;if(r.bmp&&r.bmp.file)for(var i=0;i<r.bmp.file.length;i++){var s=r.bmp.file[i];for(var o in s)typeof s[o]=="string"&&o.indexOf("file")===0&&n.preload_image(s[o])}}}function v(e){var t;switch(e.controller.type){case"AIscript":t=new u.controller;break;default:t=e.controller}return s.controller=t,s.team=e.team,t.sync=!0,t}function m(e){var r=new n({canvas:f.div("panel"),img:l.bmp.small,wh:"fit"}),i=t.data.UI.data.panel.pane_width*(e%4),s=t.data.UI.data.panel.pane_height*Math.floor(e/4);r.set_x_y(i+t.data.UI.data.panel.x,s+t.data.UI.data.panel.y),t.panel[e].uid=p,t.panel[e].spic=r,t.panel[e].hp_bound=new n({canvas:f.div("panel")}),t.panel[e].hp_bound.set_x_y(i+t.data.UI.data.panel.hpx,s+t.data.UI.data.panel.hpy),t.panel[e].hp_bound.set_w_h(t.data.UI.data.panel.hpw,t.data.UI.data.panel.hph),t.panel[e].hp_bound.el.style.background=t.data.UI.data.panel.hp_dark,t.panel[e].hp=new n({canvas:f.div("panel")}),t.panel[e].hp.set_x_y(i+t.data.UI.data.panel.hpx,s+t.data.UI.data.panel.hpy),t.panel[e].hp.set_w_h(t.data.UI.data.panel.hpw,t.data.UI.data.panel.hph),t.panel[e].hp.el.style.background=t.data.UI.data.panel.hp_bright,t.panel[e].mp_bound=new n({canvas:f.div("panel")}),t.panel[e].mp_bound.set_x_y(i+t.data.UI.data.panel.mpx,s+t.data.UI.data.panel.mpy),t.panel[e].mp_bound.set_w_h(t.data.UI.data.panel.mpw,t.data.UI.data.panel.mph),t.panel[e].mp_bound.el.style.background=t.data.UI.data.panel.mp_dark,t.panel[e].mp=new n({canvas:f.div("panel")}),t.panel[e].mp.set_x_y(i+t.data.UI.data.panel.mpx,s+t.data.UI.data.panel.mpy),t.panel[e].mp.set_w_h(t.data.UI.data.panel.mpw,t.data.UI.data.panel.mph),t.panel[e].mp.el.style.background=t.data.UI.data.panel.mp_bright}var t=this,r=[t.background.get_pos(.55,.5),t.background.get_pos(.45,.5),t.background.get_pos(.4,.5),t.background.get_pos(.6,.5)],s={match:t,controller:null,team:0};for(var o=0;o<e.length;o++){var a=e[o],l=t.data.object[a.datanum].data;d(t.data.object[a.datanum]);var c=v(a),h=new i.character(s,l,a.id);c.type==="AIcontroller"&&t.AIscript.push(new a.controller(h,t,c)),h.set_pos(r[o].x,r[o].y,r[o].z);var p=t.scene.add(h);t.character[p]=h,t.panel&&m(o)}},h.prototype.show_hp=function(){var e=this;for(var t=0;t<e.panel.length;t++)if(e.panel[t].uid!==undefined){var n=e.character[e.panel[t].uid],r=Math.floor(n.health.hp/n.health.hp_full*e.data.UI.data.panel.hpw);hp_bound=Math.floor(n.health.hp_bound/n.health.hp_full*e.data.UI.data.panel.hpw),r<0&&(r=0),hp_bound<0&&(hp_bound=0),e.panel[t].hp.set_w(r),e.panel[t].hp_bound.set_w(hp_bound),e.panel[t].mp.set_w(Math.floor(n.health.mp/n.health.mp_full*e.data.UI.data.panel.mpw))}},h.prototype.create_effects=function(t){var n=this,r=t?t:{init_size:20};r.match=n,r.stage=n.stage;var s=e.extract_array(n.grouped_object.effects,["data","id"]);n.effects[0]=new i.effects(r,s.data,s.id),n.visualeffect=n.effects[0]},h.prototype.drop_weapons=function(e){var t=this,n=t.background.get_pos(.35,.5),r=t.background.get_pos(.7,.5),i=t.background.get_pos(.5,.8);n.y=r.y=i.y=-800,t.create_weapon(100,n),t.create_weapon(101,r),t.create_weapon(150,i)},h.prototype.create_weapon=function(e,t){var n=this,r=e<150?"lightweapon":"heavyweapon",s={match:n},o=f.select_from(n.grouped_object[r],{id:e}),u=new i[r](s,o.data,o.id);u.set_pos(t.x,t.y,t.z);var a=n.scene.add(u);n[r][a]=u},h.prototype.create_background=function(e){var t=this;if(e){var n=f.select_from(t.data.background,{id:e.id}).data;t.background=new o({layers:f.div("background"),floor:f.div("floor"),scrollbar:!0,camerachase:{character:t.character}},n,e.id)}else t.background=new o(null)},h.prototype.F7=function(){var e=this;for(var t in e.character){var n=e.character[t];n.health.hp=n.health.hp_full=n.health.hp_bound=n.proper("hp")||l.gameplay.default.health.hp_full,n.health.mp=n.health.mp_full}},h.prototype.new_randomseed=function(){var e=new a;return e.seed_bytime(),e},h.prototype.random=function(){return this.randomseed.next()},h.prototype.create_controller=function(e){function n(){if(!t)return;t.time.paused&&t.pause_mess.show()}var t=this;if(e)return e.sync=!0,e.child.push({key:function(r,i){var s=t.time.paused;if(i){switch(r){case"F1":t.time.paused?t.time.paused=!1:t.time.paused=!0;break;case"F2":t.time.paused?t.TU_trans():t.time.paused=!0;break;case"F4":t.destroy(),t.manager.match_end();break;case"F7":t.F7()}t.time.paused?(t.pause_mess.hide(),setTimeout(n,4)):t.pause_mess.hide(),s!==t.time.paused&&(t.time.paused?e.paused&&e.paused(!0):e.paused&&e.paused(!1))}}}),e},h}),requirejs.config({baseUrl:"../../",config:{"F.core/sprite":{disable_css2dtransform:!0}}}),requirejs(["F.core/sprite","F.core/util","F.core/math","F.core/css!LF/tools/tools.css","LF/sprite","LF/loader!packages","LF/match","LF/util","test_cases"],function(e,t,n,r,i,s,o,u,a){function m(){var e=this;e.state={up:0,down:0,left:0,right:0,def:0,jump:0,att:0},e.config=null,e.child=[],e.sync=!0,e.seq=null,e.t=0}function g(e){var t=this;t.control=[];var n=[];t.num_player=e.scenario.player.length;for(var r=0;r<t.num_player;r++)t.control[r]=new m,n[r]={controller:t.control[r],datanum:e.scenario.player[r].datanum,team:e.scenario.player[r].team};t.match=new o({stage:c,state:{event:function(e){t.event(e)}},config:null,"package":s}),t.match.create({player:n,control:null,set:{weapon:null}}),t.cases=e.cases,t.cur_case=t.cases.length,t.next_case()}function y(e){e.parentNode.removeChild(e)}function b(e,t,n,r){var i=Math.round(t*10)/10;e.innerHTML+=(i>0&&n?"+":"")+i,r!==undefined&&i>r&&(e.style.backgroundColor="#F00")}function w(e,t){var n=Math.round(t*10)/10;e.innerHTML="&Delta;="+n,e.style.color="#FFF",t<=p?e.style.backgroundColor="#0D0":e.style.backgroundColor="#F00"}function E(e,t){e.innerHTML+=" <span class='errorlabel'>"+t+"</span>"}function S(e,t){var n=Math.round(t*10)/10;n&&(e.innerHTML+=" <span class='errorlabel'>"+(n>0?"+":"")+n+"</span>")}function x(){function e(e,t,n,r){var i=document.createElement(t);return e.appendChild(i),n&&(i.id=n),r&&(i.classname=r),i}function t(t,n){var r=e(t,"td");return n!==null&&n!==undefined&&(r.innerHTML=typeof n=="string"?n:JSON.stringify(n)),r}function r(){n++,n===a.length&&setTimeout(function(){T()},10)}var n=0;for(var o=0;o<a.length;o++)(function(n){var o=a[n].scenario.player,u=o.length,f=e(l,"div",null,"scenario"),c=[];for(var h=0;h<u;h++)c.push(s.data.object[o[h].datanum].id);s.data.object.load(c,function(){for(var l=0;l<u;l++)o[l].data=s.data.object[o[l].datanum].data;for(var c=0;c<a[n].cases.length;c++){var h=a[n].cases[c];h.result_table=[];var p=h.player[0].length;for(var d=1;d<u;d++)h.player[d].length>p&&(p=h.player[d].length);h.duration=p;for(var l=0;l<u;l++){if(!h.player[l])continue;var v=h.result_table[l]=[],m=e(f,"table"),g=e(m,"tr"),y=e(m,"tr"),b=e(m,"tr"),w=e(m,"tr"),E=e(m,"tr"),S=e(m,"tr"),x=e(m,"tr"),T=e(m,"tr"),N=e(m,"tr"),C=e(m,"tr"),k=e(m,"tr");v.r_fr=S,v.r_dx=x,v.r_dy=T,v.r_tr=N;var L=t(g,"S"+(n+1)+".C"+(c+1)+".Ch"+(l+1));L.colSpan=2,L.style.width="100px",t(y,"pic").colSpan=2,t(b,"state").colSpan=2,t(w,"key").colSpan=2,t(E),t(S,"frame"),t(x,"dx"),t(T,"dy"),t(N,"path <i>E&#772;</i>"),t(C,"total"),t(k,"log").colSpan=2,t(g,l>0?null:h.name).colSpan=99,t(E,"sum"),v.errorsum_fr=t(S),v.errorsum_dx=t(x),v.errorsum_dy=t(T),v.errorsum_tr=t(N),v.errorsum_all=t(C),t(E).colSpan=999,t(C).colSpan=999;for(var A=0;A<p;A++){var O=h.player[l][A];if(!O)continue;var M=o[l].data,_=e(t(y),"div");if(O.f!==undefined){var D=M.frame[O.f instanceof Array?O.f[0]:O.f];_.style.position="relative",_.style.width=M.bmp.file[0].w+1+"px",_.style.height=M.bmp.file[0].h+1+"px";var P=new i(M.bmp,_);P.show_pic(D.pic),P.set_x_y(0,0)}t(b,O.f!==undefined?D.state:undefined),t(w,O.k),v[A]={f:t(S,O.f),dx:t(x,O.dx),dy:t(T,O.dy),tr:t(N),log:t(k)}}}}r()})})(o)}function T(){N()}function N(){f--,f<0?(c.style.display="none",window.location.href.match("no_log")||k([window.location.href.slice(window.location.href.lastIndexOf("/")+1),v.passed,v.finished,v.delta,C()[0]+","+C()[1]])):new g(a[f])}function C(){var e=navigator.appName,t=navigator.userAgent,n,r=t.match(/(opera|chrome|safari|firefox|msie)\/?\s*(\.?\d+(\.\d+)*)/i);return r&&(n=t.match(/version\/([\.\d]+)/i))!=null&&(r[2]=n[1]),r=r?[r[1],r[2]]:[e,navigator.appVersion,"-?"],r}function k(e){var t=document.createElement("form"),n=document.createElement("iframe");n.name="hiddenframe",n.style.display="none";var r=document.getElementsByTagName("body")[0];t.action="https://docs.google.com/forms/d/1p212mOPl37gJ7AA87b_eW1OOwY3h9-zdXnVjDRYPwDY/formResponse",t.method="POST",t.style.display="none",t.target="hiddenframe",r.appendChild(n),r.appendChild(t);var i=[];for(var s=0;s<5;s++)i[s]=document.createElement("input"),i[s].type="text",t.appendChild(i[s]);i[0].name="entry.543839435",i[1].name="entry.244956536",i[2].name="entry.1649007291",i[3].name="entry.36587793",i[4].name="entry.962836516",i[0].value=e[0],i[1].value=e[1],i[2].value=e[2],i[3].value=e[3],i[4].value=e[4],t.submit()}(function(){var e="<div class='Fbar'>F.LF/unit test suite <a href='https://docs.google.com/spreadsheet/lv?key=0AqAWO3FZ2ZFrdGZBa2xDNzdDeVdhNU9UQVMtaklpQXc&type=view&gid=0&f=false&sortcolid=20&sortasc=false&rowsperpage=250'>log</a><a href='../docs/unit_test_suite.html'>Help</a></div><div id='overall'></div><div id='stage' class='canvas'></div><div id='data'></div>",t=document.createElement("div");t.innerHTML=e;var n=document.getElementsByTagName("body")[0];n.insertBefore(t,n.firstChild)})(),u.setup_resourcemap(s,e);var a=a.test_cases,f=a.length,l=document.getElementById("data"),c=document.getElementById("stage"),h=document.getElementById("overall"),p=10,d=30,v={passed:0,finished:0,delta:0};m.prototype.clear_states=function(){},m.prototype.fetch=function(){var e=this;if(!e.seq)return;if(e.t>=e.seq.length)return;if(e.t>0&&e.seq[e.t-1].k){var n=t.make_array(e.seq[e.t-1].k);for(var r=0;r<n.length;r++)for(var i=0;i<e.child.length;i++)if(n[r].indexOf("hold ")===0){var s=n[r].slice(5);e.state[s]=0,e.child[i].key(s,0)}}if(e.t>=0&&e.seq[e.t].k){var n=t.make_array(e.seq[e.t].k);for(var r=0;r<n.length;r++)for(var i=0;i<e.child.length;i++)if(n[r].indexOf("hold ")===0){var s=n[r].slice(5);e.child[i].key(s,1),e.state[s]=1}else if(n[r].indexOf("longhold ")===0){var s=n[r].slice(9);e.child[i].key(s,1),e.state[s]=1}else if(n[r].indexOf("release ")===0){var s=n[r].slice(8);e.child[i].key(s,0),e.state[s]=0}else e.child[i].key(n[r],1),e.state[n[r]]=1,e.child[i].key(n[r],0),e.state[n[r]]=0}},m.prototype.flush=function(){},m.prototype.frame=function(){var e=this;e.t++},m.prototype.assign=function(e){var t=this;t.seq=e,t.t=-d},m.prototype.type="keyboard",g.prototype.next_case=function(){var e=this;e.cur_case--;if(e.cur_case<0)e.match.destroy(),N();else{e.ccase=e.cases[e.cur_case],e.duration=e.ccase.duration,e.result=[],e.mem=[];for(var t=0;t<e.num_player;t++)e.control[t].assign(e.ccase.player[t]),e.result[t]=[],e.mem[t]={};e.t=-d,e.match.F7()}},g.prototype.event=function(e){var t=this;if(e==="TU"){t.t===-d&&typeof t.ccase.setup=="function"&&t.ccase.setup(t.match),t.t++;for(var n=0;n<t.num_player;n++)t.control[n].frame()}else if(e==="transit"){if(t.t>=0&&t.t<t.duration)for(var n=0;n<t.num_player;n++)t.result[n][t.t]={},t.ccase.player[n]&&t.ccase.player[n][t.t]&&t.test(t.match.character[n+1],t.ccase.player[n][t.t],t.result[n][t.t],t.mem[n]);t.t===t.duration&&(t.show_result(),t.next_case())}else if(e==="start")for(var n=0;n<t.num_player;n++)(function(e){t.match.character[e+1].log=function(n){t.ccase.result_table[e]&&t.ccase.result_table[e][t.t]&&(t.ccase.result_table[e][t.t].log.innerHTML+=n+"<br>")}})(n)},g.prototype.test=function(e,r,i,s){function u(e,n){return n instanceof Array?t.search_array(n,function(t){return t===e})!==-1:e===n}var o=this;if(e.frame.N===230)var a;r.f!==undefined&&(u(e.frame.N,r.f)?i.f="no error":i.f=e.frame.N),o.t===0?(s.ps={x:0,y:0},s.psl={x:0,y:0},s.pso={x:e.ps.x,y:e.ps.y}):o.t>=1&&(r.dx!==undefined&&(i.dx=e.ps.x-s.psl.x-r.dx,s.ps.x+=r.dx),r.dy!==undefined&&(i.dy=e.ps.y-s.psl.y-r.dy,s.ps.y+=r.dy),i.tr=n.distance(n.sub(e.ps,s.pso),s.ps)),s.psl.x=e.ps.x,s.psl.y=e.ps.y},g.prototype.show_result=function(){var e=this;for(var t=0;t<e.num_player;t++){var n=0,r=0,i=0,s=0,o=0,u,a,f,l=0;for(var c=0;c<e.duration;c++){var d=e.result[t][c],m=e.ccase.result_table[t][c];d.f!==undefined&&(u=!0,d.f!=="no error"&&(E(m.f,d.f),r+=1)),d.dx!==undefined&&(a=!0,i+=d.dx>0?d.dx:-d.dx,S(m.dx,d.dx)),d.dy!==undefined&&(f=!0,s+=d.dy>0?d.dy:-d.dy,S(m.dy,d.dy)),d.tr!==undefined&&(d.tr&&l++,o+=d.tr>0?d.tr:-d.tr,b(m.tr,d.tr))}u||y(e.ccase.result_table[t].r_fr),a||y(e.ccase.result_table[t].r_dx),f||y(e.ccase.result_table[t].r_dy),!a&&!f&&y(e.ccase.result_table[t].r_tr),n=r+i+s,b(e.ccase.result_table[t].errorsum_fr,r,0,0),b(e.ccase.result_table[t].errorsum_dx,i),b(e.ccase.result_table[t].errorsum_dy,s),b(e.ccase.result_table[t].errorsum_tr,l?o/l:0),w(e.ccase.result_table[t].errorsum_all,n),n<=p&&v.passed++,v.finished++,v.delta+=n,h.innerHTML="Overall: Passed("+v.passed+"/"+v.finished+")"+" &Delta;="+v.delta}e.ccase.result_table.length=0},function(){x()}()}),define("LF/tools/unit_test_suite",function(){});